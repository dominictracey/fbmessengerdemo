function prepopulateEditPayment(e){$.ajax({url:ACC.config.contextPath+"/checkout/multi/payment-method/getPaymentInfo",type:"POST",data:{paymentId:e},cache:!1,async:!0,success:function(e){var t=$("#billingAddressEditForm");t.find("#address\\.firstName").val(e.billingAddress.firstName),t.find("#address\\.surname").val(e.billingAddress.lastName),t.find("#address\\.line1").val(e.billingAddress.line1),t.find("#address\\.line2").val(e.billingAddress.line2),t.find("#address\\.country").val(e.billingAddress.country.isocode).change(),t.find("#address\\.townCity").val(e.billingAddress.town),t.find("#address\\.region").val(e.billingAddress.region.isocodeShort).change(),t.find("#address\\.postcode").val(e.billingAddress.postalCode),t.find("#address\\.phoneNumber").val(e.billingAddress.phone)},error:function(e,t,d){console.log("Status: "+t),console.log("Error: "+d)}})}function checkAddPaymentStatusInterval(e,t){setInterval(function(){checkAddPaymentStatus(e)},t)}function checkAddPaymentStatus(e){$.ajax({url:ACC.config.contextPath+"/checkout/payment/sa/haspaymentsaved",cache:!1,dataType:"json",data:{cartGuid:e},success:function(e){var t=removeParams(window.location+"");1==e?window.location=t+"/payment-success":2==e&&(window.location=t+"/payment-error")}})}function removeParams(e){var t=0,d=e;return-1==(t=e.indexOf("?"))&&(t=e.indexOf("#")),-1!=t&&(d=e.substring(0,t)),d}ACC.account={_autoload:["bindOrderHistorySort","bindOrderPagination","bindAddAddress","bindCancelAddAddress","bindEditProfile","cancelEditProfile","bindAddPassword","bindCancelAccountPassword","bindEditAccountAddress","bindCancelAddPayment","bindAddPayment","bindAddPaymentSubmit","bindEditPayment","bindSubmitEditPayment","bindCancelEditPayment","handleAccountEditAddPaymentClicks"],bindOrderHistorySort:function(){$(document).on("change","#orderHistorySelect",function(){var e=$("#orderHistorySelect").find(":selected").val();window.location.href=replaceUrlParam(window.location+"","dateMonths",e)})},bindOrderPagination:function(){$(document).on("click","li.pagination-orders",function(){var e=$(this).val();window.location.href=replaceUrlParam(window.location+"","page",e)})},bindAddAddress:function(){$(document).on("click","#addAddressSettings",function(){$("#address\\.line1").val(""),$("#address\\.line2").val(""),$("#address\\.townCity").val(""),$("#address\\.country").val([]).change(),$("#address\\.region").val([]).change(),$("#address\\.phone").val(""),$("#address\\.postcode").val(""),$("#address\\.firstName").val(""),$("#address\\.surname").val(""),$("#addressId").val(""),$("#defaultAddress").is(":checked")&&$("#defaultAddress").click(),$("#addAddressLabel").removeClass("hidden"),$("#updateAddressLabel").addClass("hidden"),$("#account-addressAddEditAddress").removeClass("hidden")})},bindCancelAddAddress:function(){$(document).on("click","#cancelAddAddress",function(){$("#account-addressAddEditAddress").addClass("hidden")})},bindEditProfile:function(){$(document).on("click","#editProfile",function(){$("#account-information").removeClass("hidden")})},cancelEditProfile:function(){$(document).on("click","#cancelEditProfile",function(){})},bindCancelEditPayment:function(){$(document).on("click","#cancelEditPayment",function(){$("#account-editPaymentInfo").addClass("hidden")})},bindAddPassword:function(){$(document).on("click","#addAccountPassword",function(){$("#account-password").removeClass("hidden")})},bindCancelAccountPassword:function(){$(document).on("click","#cancelAccountPassword",function(){$("#account-password").addClass("hidden")})},bindEditAccountAddress:function(){$(document).on("click",".accountEditAddress",function(){$("#addAddressLabel").addClass("hidden"),$("#updateAddressLabel").removeClass("hidden");var e=$(this).attr("data-address-id"),t="#hiddenAddress-"+e,d=$(t+" input[name=hidden_line1]").val(),a=$(t+" input[name=hidden_line2]").val(),i=$(t+" input[name=hidden_town]").val(),n=$(t+" input[name=hidden_country]").val(),o=$(t+" input[name=hidden_state]").val(),r=$(t+" input[name=hidden_phone]").val(),s=$(t+" input[name=hidden_postalCode]").val(),c=$(t+" input[name=hidden_firstName]").val(),l=$(t+" input[name=hidden_lastName]").val(),u=$(t+" input[name=hidden_default]").val();$("#address\\.line1").val(d),$("#address\\.line2").val(a),$("#address\\.townCity").val(i),$("#address\\.country").val(n).change(),$("#address\\.region").val(o).change(),$("#address\\.phone").val(r),$("#address\\.postcode").val(s),$("#address\\.firstName").val(c),$("#address\\.surname").val(l),$("#addressId").val(e),"true"==u&&"true"!=!$("#defaultAddress").is(":checked")?$("#defaultAddress").click():"false"==u&&$("#defaultAddress").is(":checked")&&$("#defaultAddress").click(),$("#account-addressAddEditAddress").removeClass("hidden")})},bindCancelAddPayment:function(){$(document).on("click","#cancelAddPayment",function(){$("#account-addPaymentInfo").addClass("hidden")})},bindAddPayment:function(){$(document).on("click","#addPaymentSettings",function(){$("#account-addPaymentInfo").removeClass("hidden")}),$("#silentOrderPostForm").hasClass("bv-form")||ACC.silentorderpost.bindValidationPaymentForm("add")},bindEditPayment:function(){$(document).on("click",".accountEditPayment",function(){var e=$(this).attr("data-payment-id"),t=$(this).attr("data-order-id");prepopulateEditPayment(e),$("#editPaymentId").html(e),$("#editOrderId").html(t),$("#account-editPaymentInfo").removeClass("hidden")}),$("#silentEditOrderPostForm").hasClass("bv-form")||ACC.silentorderpost.bindValidationPaymentForm("edit")},bindSubmitEditPayment:function(){$(document).on("click","#submitEditPayment",function(){if($("#silentEditOrderPostForm").data("bootstrapValidator").validate(),$("#silentEditOrderPostForm").data("bootstrapValidator").isValid()){var e,t=$("#sopEditRequestIframe"),d=t.contents().find("#sopRequestForm"),a=$("#billingAddressEditForm");e={paymentId:$("#editPaymentId").html(),orderIdPayment:$("#editOrderId").html(),bill_to_forename:a.find("#address\\.firstName").val(),bill_to_surname:a.find("#address\\.surname").val(),bill_to_address_country:"US",bill_to_address_city:a.find("#address\\.townCity").val(),bill_to_address_state:a.find("#address\\.region").val(),bill_to_address_line1:a.find("#address\\.line1").val(),bill_to_address_line2:a.find("#address\\.line2").val(),bill_to_address_postal_code:a.find("#address\\.postcode").val(),myAccount:"true",firstSixDigits:getFirstSixDigits(),lastFourDigits:getLastFourDigits()},$.ajax({url:ACC.config.contextPath+"/checkout/payment/sa/sopEditAjax",type:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},dataType:"json",data:JSON.stringify(e),cache:!1,success:function(e){console.log(e),d.find("#access_key").val(e.access_key),d.find("#profile_id").val(e.profile_id),d.find("#transaction_uuid").val(e.transaction_uuid),d.find("#signed_date_time").val(e.signed_date_time),d.find("#locale").val(e.locale),d.find("#reference_number").val(e.reference_number),d.find("#amount").val(e.amount),d.find("#currency").val(e.currency),d.find("#payment_method").val(e.payment_method),d.find("#bill_to_forename").val(e.bill_to_forename),d.find("#bill_to_surname").val(e.bill_to_surname),d.find("#bill_to_email").val(e.bill_to_email),d.find("#bill_to_address_line1").val(e.bill_to_address_line1),d.find("#bill_to_address_line2").val(e.bill_to_address_line2),d.find("#bill_to_address_city").val(e.bill_to_address_city),d.find("#bill_to_address_country").val(e.bill_to_address_country),d.find("#bill_to_address_postal_code").val(e.bill_to_address_postal_code),d.find("#bill_to_address_state").val(e.bill_to_address_state),d.find("#override_custom_receipt_page").val(e.override_custom_receipt_page),d.find("#override_backoffice_post_url").val(e.override_backoffice_post_url),d.find("#signed_field_names").val(e.signed_field_names),d.find("#unsigned_field_names").val(e.unsigned_field_names),d.find("#signature").val(e.signature),d.find("#recurringSubscriptionInfo_subscriptionID").val(e.recurringSubscriptionInfo_subscriptionID),d.find("#payment_token").val(e.recurringSubscriptionInfo_subscriptionID),d.find("#card_type").val(getEditCardType()),d.find("#card_number").val(getEditCardNumber()),d.find("#card_expiry_date").val(getEditCardExpireDate()),d.find("#card_cvn").val(getEditCardCvn()),d.submit(),startEditSOPIframeTimeout(t),checkAddPaymentStatusInterval(t.contents().find("#cart_guid").val(),2e3)},error:function(e,t,d){console.log("Status: "+t),console.log("Error: "+d)}})}})},bindAddPaymentSubmit:function(){$(document).on("click","#submitAddPayment",function(){if($("#silentOrderPostForm").data("bootstrapValidator").validate(),$("#silentOrderPostForm").data("bootstrapValidator").isValid()){var e,t=$("#sopRequestIframe"),d=t.contents().find("#sopRequestForm"),a=$("#billingAddressForm");e={bill_to_forename:a.find("#address\\.firstName").val(),bill_to_surname:a.find("#address\\.surname").val(),bill_to_address_country:"US",bill_to_address_city:a.find("#address\\.townCity").val(),bill_to_address_state:a.find("#address\\.region").val(),bill_to_address_line1:a.find("#address\\.line1").val(),bill_to_address_line2:a.find("#address\\.line2").val(),bill_to_address_postal_code:a.find("#address\\.postcode").val(),savePaymentInfo:"true",firstSixDigits:getFirstSixDigits(),lastFourDigits:getLastFourDigits()},$.ajax({url:ACC.config.contextPath+"/checkout/payment/sa/sopAjax",type:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},dataType:"json",data:JSON.stringify(e),cache:!1,success:function(e){console.log(e),d.find("#access_key").val(e.access_key),d.find("#profile_id").val(e.profile_id),d.find("#transaction_uuid").val(e.transaction_uuid),d.find("#signed_date_time").val(e.signed_date_time),d.find("#locale").val(e.locale),d.find("#reference_number").val(e.reference_number),d.find("#amount").val(e.amount),d.find("#currency").val(e.currency),d.find("#payment_method").val(e.payment_method),d.find("#bill_to_forename").val(e.bill_to_forename),d.find("#bill_to_surname").val(e.bill_to_surname),d.find("#bill_to_email").val(e.bill_to_email),d.find("#bill_to_address_line1").val(e.bill_to_address_line1),d.find("#bill_to_address_line2").val(e.bill_to_address_line2),d.find("#bill_to_address_city").val(e.bill_to_address_city),d.find("#bill_to_address_country").val(e.bill_to_address_country),d.find("#bill_to_address_postal_code").val(e.bill_to_address_postal_code),d.find("#bill_to_address_state").val(e.bill_to_address_state),d.find("#override_custom_receipt_page").val(e.override_custom_receipt_page),d.find("#override_backoffice_post_url").val(e.override_backoffice_post_url),d.find("#signed_field_names").val(e.signed_field_names),d.find("#unsigned_field_names").val(e.unsigned_field_names),d.find("#signature").val(e.signature),d.find("#card_type").val(getCardType()),d.find("#card_number").val(getCardNumber()),d.find("#card_expiry_date").val(getCardExpireDate()),d.find("#card_cvn").val(getCardCvn()),d.submit(),ACC.secureacceptance.startSOPIframeTimeout(t),checkAddPaymentStatusInterval(t.contents().find("#cart_guid").val(),2e3)},error:function(e,t,d){console.log("Status: "+t),console.log("Error: "+d)}})}})},handleAccountEditAddPaymentClicks:function(){$("#account-editPaymentInfo select[id='EditExpiryMonth']").selectpicker("destroy").selectpicker({liveSearch:!0}),$("#account-editPaymentInfo select[id='EditExpiryYear']").selectpicker("destroy").selectpicker({liveSearch:!0}),$("#account-editPaymentInfo #EditExpiryYear").change(function(){$("#silentEditOrderPostForm").data("bootstrapValidator").resetField($("#account-editPaymentInfo #EditExpiryMonth"))}),$("#account-editPaymentInfo #edit_card_cardType").change(function(){$("#EditExpiryMonth").val("default"),$("#EditExpiryYear").val("default"),$("#edit_card_cvNumber").val(""),$("#edit_card_accountNumber").val(""),$("#edit_card_name").val(""),$("#silentEditOrderPostForm").data("bootstrapValidator").resetField($("#account-editPaymentInfo #EditExpiryMonth")),$("#silentEditOrderPostForm").data("bootstrapValidator").resetField($("#account-editPaymentInfo #EditExpiryYear")),$("#silentEditOrderPostForm").data("bootstrapValidator").resetField($("#account-editPaymentInfo #edit_card_accountNumber")),$("#silentEditOrderPostForm").data("bootstrapValidator").resetField($("#account-editPaymentInfo #edit_card_cvNumber")),$("#silentEditOrderPostForm").data("bootstrapValidator").resetField($("#account-editPaymentInfo #edit_card_name")),$("#account-editPaymentInfo select[id='EditExpiryMonth']").selectpicker("destroy").selectpicker({liveSearch:!0}),$("#account-editPaymentInfo select[id='EditExpiryYear']").selectpicker("destroy").selectpicker({liveSearch:!0})}),$("#account-editPaymentInfo").on("hide.bs.modal",function(){ACC.account.resetAccountPaymentForm("edit")}),$("#account-addPaymentInfo").on("hide.bs.modal",function(){ACC.account.resetAccountPaymentForm("add")})},resetAccountPaymentForm:function(e){var t="",d="",a="",i="";"edit"==e?(t="#silentEditOrderPostForm",d="#EditExpiryMonth",a="#EditExpiryYear",i="#edit_card_cardType"):"add"==e&&(t="#silentOrderPostForm",d="#ExpiryMonth",a="#ExpiryYear",i="#card_cardType"),$(t)[0].reset(),$(t).bootstrapValidator("resetForm"),$(d).selectpicker("refresh"),$(a).selectpicker("refresh"),$(i).selectpicker("refresh")}};var getCardType=function(){return $("#card_cardType option:selected").val()},getCardCvn=function(){return $("#card_cvNumber").val()},getCardNumber=function(){return $("#card_accountNumber").val()},getLastFourDigits=function(){var e=getCardNumber();return null!=e&&0!=e.length||(e=getEditCardNumber()),e.substr(e.length-4)},getFirstSixDigits=function(){var e=getCardNumber();return null!=e&&0!=e.length||(e=getEditCardNumber()),e.substr(0,6)},getEditCardType=function(){return $("#edit_card_cardType option:selected").val()},getEditCardCvn=function(){return $("#edit_card_cvNumber").val()},getEditCardNumber=function(){return $("#edit_card_accountNumber").val()},getCardExpireDate=function(){return $("#ExpiryMonth option:selected").text()+"-"+$("#ExpiryYear option:selected").text()},getEditCardExpireDate=function(){return $("#EditExpiryMonth option:selected").text()+"-"+$("#EditExpiryYear option:selected").text()},getCardExpireYear=function(){return $("#ExpiryYear option:selected").val()},getCardExpireMonth=function(){return $("#ExpiryMonth option:selected").val()};function startEditSOPIframeTimeout(e){var t=null;e.load(function(){t&&clearTimeout(t),t=setTimeout(function(){$("#sopEditIframeCbox").dialog(),$("#sopEditIframeCbox").dialog("open")},3e3)})}function replaceUrlParam(e,t,d){null==d&&(d="");var a=new RegExp("\\b("+t+"=).*?(&|$)");return 0<=e.search(a)?e.replace(a,"$1"+d+"$2"):e+(0<e.indexOf("?")?"&":"?")+t+"="+d}$(document).ready(function(){$("#cancelEditProfile, .js-close-edit-profile-modal").click(function(){$("#account-information").modal("hide")}),$(".js-open-edit-profile-modal").click(function(){$("#account-information").modal("show")}),$(".accountEditAddress, #addAddressSettings").click(function(){$("#account-addressAddEditAddress").modal("show")}),$("#cancelAddAddress").click(function(){$("#account-addressAddEditAddress").modal("hide")}),$(".accountEditPayment").click(function(){$("#account-editPaymentInfo").modal("show")}),$("#cancelEditPayment").click(function(){$("#account-editPaymentInfo").modal("hide")}),$("#addPaymentSettings").click(function(){$("#account-addPaymentInfo").modal("show")}),$("#cancelAddPayment").click(function(){$("#account-addPaymentInfo").modal("hide")}),$("#addAccountPassword").click(function(){$("#account-password").modal("show")}),$(window).width()<880?($(".account-overview").addClass("account-overview__mobile-version"),$("#acctOverviewReorder").click(function(){window.location.href="/my-account/reorders"}),$("#acctOverviewRecommendations").click(function(){window.location.href="/my-account/recommendedPrescriptions"}),$("#acctOverviewAutoship").click(function(){window.location.href="/autoship"})):$(".account-overview").addClass("account-overview__desktop-version"),$(window).resize(function(){$(window).width()<880&&$(".account-overview").hasClass("account-overview__desktop-version")?($(".account-overview").addClass("account-overview__mobile-version").removeClass("account-overview__desktop-version"),$("#acctOverviewReorder").click(function(){window.location.href="/my-account/reorders"}),$("#acctOverviewRecommendations").click(function(){window.location.href="/my-account/recommendedPrescriptions"}),$("#acctOverviewAutoship").click(function(){window.location.href="/autoship"})):880<$(window).width()&&$(".account-overview").hasClass("account-overview__mobile-version")&&($(".account-overview").addClass("account-overview__desktop-version").removeClass("account-overview__mobile-version"),$("#acctOverviewReorder").off("click"),$("#acctOverviewRecommendations").off("click"),$("#acctOverviewAutoship").off("click"))}),0<$("#updatePasswordForm").length&&$("#updatePasswordForm").bootstrapValidator({live:"disabled",fields:{currentPassword:{validators:{notEmpty:{message:account_updatePassMSGs.currentPwd}}},newPassword:{validators:{notEmpty:{message:account_updatePassMSGs.newPwd},regexp:{regexp:/^(?=.*?[A-Z])(?=.*?[a-z])(?!.*[!*#()])(?=.*?[0-9]).{8,}$/,message:account_updatePassMSGs.newPwdReauirements}}},checkNewPassword:{validators:{notEmpty:{message:account_updatePassMSGs.confirmPwd},identical:{field:"newPassword",message:account_updatePassMSGs.pwdMatch}}}}}).on("error.field.bv",function(e,t){t.bv.getSubmitButton()&&t.bv.disableSubmitButtons(!1)}),0<$("#account-update-profile").length&&$("#account-update-profile").bootstrapValidator({live:"disabled",fields:{firstName:{validators:{notEmpty:{message:update_profileErrorMSGs.requierdField}}},lastName:{validators:{notEmpty:{message:update_profileErrorMSGs.requierdField}}},email:{validators:{emailAddress:{message:update_profileErrorMSGs.emailInvalid},callback:{message:update_profileErrorMSGs.requierdField,callback:function(e,t,d){return 0===$("#profile\\.checkEmail").val().length&&0===$("#profile\\.pwd").val().length||0<d.val().length}}}},chkEmail:{validators:{identical:{field:"email",message:update_profileErrorMSGs.confirmEmail},callback:{message:update_profileErrorMSGs.requierdField,callback:function(e,t,d){return 0===$("#profile\\.email").val().length&&0===$("#profile\\.pwd").val().length||0<d.val().length}}}},password:{validators:{regexp:{regexp:/^(?=.*?[A-Z])(?=.*?[a-z])(?!.*[!*#()])(?=.*?[0-9]).{8,}$/,message:update_profileErrorMSGs.newPwdReauirements},callback:{message:update_profileErrorMSGs.requierdField,callback:function(e,t,d){return 0===$("#profile\\.email").val().length&&0===$("#profile\\.checkEmail").val().length||0<d.val().length}}}}}}).on("error.field.bv",function(e,t){t.bv.getSubmitButton()&&t.bv.disableSubmitButtons(!1)}),$("#update_pass_modal").on("hide.bs.modal",function(e){$("#updatePasswordForm").trigger("reset"),$("#updatePasswordForm").bootstrapValidator("resetForm",!0)}),$("#account-update-profile").on("hide.bs.modal",function(e){$("#account-update-profile").trigger("reset"),$("#account-update-profile").bootstrapValidator("resetForm",!0)}),$("#account-update-profile .btn-submit").click(function(e){if($("#account-update-profile").bootstrapValidator("revalidateField","email"),$("#account-update-profile").bootstrapValidator("revalidateField","chkEmail"),$("#account-update-profile").bootstrapValidator("revalidateField","password"),$("#account-update-profile").data("bootstrapValidator").validate(),!$("#account-update-profile").data("bootstrapValidator").isValid())return e.preventDefault(),!1})});
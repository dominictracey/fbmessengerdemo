ACC.address={_autoload:["bindToChangeAddressButton","bindCreateUpdateAddressForm","bindSuggestedDeliveryAddresses","bindCountrySpecificAddressForms","showAddressFormButtonPanel","bindViewAddressBook","bindContinueButton","bindToColorboxClose","showRemoveAddressFromBookConfirmation","backToListAddresses","showAddNewAddressForm","handleSelectedAddress","showEditAddressForm"],spinner:$("<img src='"+ACC.config.commonResourcePath+"/images/spinner.gif' />"),addressID:"",handleChangeAddressButtonClick:function(){return ACC.address.addressID=$(this).data("address")?$(this).data("address"):"",$("#summaryDeliveryAddressFormContainer").show(),$("#summaryOverlayViewAddressBook").show(),$("#summaryDeliveryAddressBook").hide(),$.getJSON(getDeliveryAddressesUrl,ACC.address.handleAddressDataLoad),!1},handleAddressDataLoad:function(e){ACC.address.setupDeliveryAddressPopupForm(e),ACC.colorbox.open("",{inline:!0,href:"#summaryDeliveryAddressOverlay",overlayClose:!1,onOpen:function(){ACC.address.emptyAddressForm(),$(document).on("change","#saveAddress",function(){var e=$(this).prop("checked");$("#defaultAddress").prop("disabled",!e),e||$("#defaultAddress").prop("checked",!1)})}})},setupDeliveryAddressPopupForm:function(e){$("#summaryDeliveryAddressBook").html($("#deliveryAddressesTemplate").tmpl({addresses:e})),$("#summaryDeliveryAddressBook button.use_address").click(ACC.address.handleSelectExistingAddressClick),$("#summaryDeliveryAddressBook button.edit").click(ACC.address.handleEditAddressClick),$("#summaryDeliveryAddressBook button.default").click(ACC.address.handleDefaultAddressClick)},emptyAddressForm:function(){var e={url:getDeliveryAddressFormUrl,data:{addressId:ACC.address.addressID,createUpdateStatus:""},type:"GET",success:function(e){$("#summaryDeliveryAddressFormContainer").html(e),ACC.address.bindCreateUpdateAddressForm()}};$.ajax(e)},handleSelectExistingAddressClick:function(){var e=$(this).attr("data-address");return $.postJSON(setDeliveryAddressUrl,{addressId:e},ACC.address.handleSelectExitingAddressSuccess),!1},handleEditAddressClick:function(){$("#summaryDeliveryAddressFormContainer").show(),$("#summaryOverlayViewAddressBook").show(),$("#summaryDeliveryAddressBook").hide();var e=$(this).attr("data-address"),d={url:getDeliveryAddressFormUrl,data:{addressId:e,createUpdateStatus:""},target:"#summaryDeliveryAddressFormContainer",type:"GET",success:function(e){ACC.address.bindCreateUpdateAddressForm(),ACC.colorbox.resize()},error:function(e,d,s){alert("Failed to update cart. Error details ["+e+", "+d+", "+s+"]")}};return $(this).ajaxSubmit(d),!1},handleDefaultAddressClick:function(){var e=$(this).attr("data-address"),d={url:setDefaultAddressUrl,data:{addressId:e},type:"GET",success:function(e){ACC.address.setupDeliveryAddressPopupForm(e)},error:function(e,d,s){alert("Failed to update address book. Error details ["+e+", "+d+", "+s+"]")}};return $(this).ajaxSubmit(d),!1},handleSelectExitingAddressSuccess:function(e){null!=e?(ACC.refresh.refreshPage(e),ACC.colorbox.close()):alert("Failed to set delivery address")},bindCreateUpdateAddressForm:function(){$(".create_update_address_form").each(function(){var e={type:"POST",beforeSubmit:function(){$("#checkout_delivery_address").block({message:ACC.address.spinner})},success:function(e){$("#summaryDeliveryAddressFormContainer").html(e);var d=$(".create_update_address_id").attr("status");null!=d&&"success"===d.toLowerCase()?(ACC.refresh.getCheckoutCartDataAndRefreshPage(),ACC.colorbox.close()):(ACC.address.bindCreateUpdateAddressForm(),ACC.colorbox.resize())},error:function(e,d,s){alert("Failed to update cart. Error details ["+e+", "+d+", "+s+"]")},complete:function(){$("#checkout_delivery_address").unblock()}};$(this).ajaxForm(e)})},refreshDeliveryAddressSection:function(e){$(".summaryDeliveryAddress").replaceWith($("#deliveryAddressSummaryTemplate").tmpl(e))},bindSuggestedDeliveryAddresses:function(){var e=$(".add_edit_delivery_address_id").attr("status");null!=e&&"hasSuggestedAddresses"==e&&ACC.address.showSuggestedAddressesPopup()},showSuggestedAddressesPopup:function(){$("#popup_suggested_delivery_addresses_form").modal("show")},bindCountrySpecificAddressForms:function(){ACC.address.displayCountrySpecificAddressForm({addressCode:"",countryIsoCode:"US"},ACC.address.showAddressFormButtonPanel)},showAddressFormButtonPanel:function(){""!==$("#countrySelector :input").val()&&$("#addressform_button_panel").show()},bindToColorboxClose:function(){$(document).on("click",".closeColorBox",function(){ACC.colorbox.close()})},displayCountrySpecificAddressForm:function(e,d){(0<$("form[action='/checkout/multi/delivery-address/add']").length||0<$("form[action='add-address']").length)&&$.ajax({url:ACC.config.encodedContextPath+"/my-account/addressform",async:!0,data:e,dataType:"html",beforeSend:function(){$("#i18nAddressForm").html(ACC.address.spinner)}}).done(function(e){$("#i18nAddressForm").html($(e).html()),"function"==typeof d&&d.call(),$(".selectpicker").selectpicker({}),$("select[id='address.region']").selectpicker("destroy").selectpicker({liveSearch:!0,noneSelectedText:"Please select",size:12}),$("select[id='ExpiryMonth']").selectpicker("destroy").selectpicker({liveSearch:!0}),$("select[id='ExpiryYear']").selectpicker("destroy").selectpicker({liveSearch:!0}),$("#addressbook form").submit(function(e){e.preventDefault();var d=$("input[name=selectedAddressCode]:checked").val();if("false"===$("#address_"+d+" .verified").val()){var s=$("#address_"+d+" .line1").val(),r=$("#address_"+d+" .line2").val(),a=$("#address_"+d+" .townCity").val(),t=$("#address_"+d+" .countryIso").val(),o=$("#address_"+d+" .region").val(),i=$("#address_"+d+" .postcode").val(),n=($("#address_"+d+" .titleCode").val(),$("#address_"+d+" .firstName").val()),l=$("#address_"+d+" .lastName").val(),c=$("#address_"+d+" .companyName").val(),u=$("#address_"+d+" .phone").val(),m=$("#address_"+d+" .billingAddress").val(),p=$("#address_"+d+" .shippingAddress").val(),v=$("#address_"+d+" .defaultAddress").val(),f=$("#address_"+d+" .visibleInAddressBook").val(),h=$("#address_"+d+" .editable").val();$("#popup_delivery_address_verification_form").modal("show"),$("#popup_delivery_address_verification_form .status_msg").hide(),$("#popup_delivery_address_verification_form .loading").show();var y={verified:!0,id:d,defaultAddress:v,shippingAddress:p,billingAddress:m,firstName:n,lastName:l,companyName:c,phone:u,line1:s,line2:r,town:a,postalCode:i,country:{isocode:t},shippingAddress:p,visibleInAddressBook:f,editable:h,region:{isocode:o,name:o}};$.ajax({type:"POST",url:"/dav",data:{reference_code:"1",addressData:JSON.stringify(y)},dataType:"json",timeout:5e3,success:function(e){"REJECT"==e.decision&&($("#popup_delivery_address_verification_form .loading").hide(),$("#popup_delivery_address_verification_form .reject_existing_address").show(),$(".addressEnteredLine1").html(s),$(".addressEnteredCityStateZip").html(a+", "+o+" "+i),$(".addressEntredCountry").html(t),$(".continueWithThisAddress").click(function(){$.get("/checkout/multi/delivery-address/mark_verified?pk="+d,function(e){$("#addressbook form").unbind(),$("#addressbook form").submit()})}),$("#buttonExistingAddressRejectedAddAddress").click(function(){$("#popup_delivery_address_verification_form").modal("hide"),$("#addressbook").toggle(),$(".addNewAddressContainer").toggleClass("display-none")})),"ACCEPT"==e.decision&&($("#popup_delivery_address_verification_form .loading").hide(),$("#popup_delivery_address_verification_form .pick_between2").show(),$(".standardizedAddress1").html(e.standardizedAddress1),void 0!==e.standardizedAddress2&&null!=e.standardizedAddress2&&""!=e.standardizedAddress2?($(".standardizedAddress2").html(e.standardizedAddress2),$(".standardizedAddress2").show()):$(".standardizedAddress2").hide(),$(".standardizedCity").html(e.standardizedCity+","),$(".standardizedState").html(e.standardizedState),$(".standardizedPostal").html(e.standardizedPostalCode),$(".standardizedISOCountry").html(e.standardizedISOCountry),$("#enteredAddress").html("line1:"+s+" | line2:"+s+" | townCity: "+a+" | postcode:"+i+" | country:"+t+" | region(state): "+o),$(".addressEnteredLine1").html(s),null!=r&&""!=r?($(".addressEnteredLine2").html(r),$(".addressEnteredLine2").show()):$(".addressEnteredLine2").hide(),$(".addressEnteredCityStateZip").html(a+", "+o+" "+i),$(".addressEntredCountry").html(t),$(".continueWithEnteredAddress").click(function(){$("#popup_delivery_address_verification_form .status_msg").hide(),$("#popup_delivery_address_verification_form .loading").show(),$.get("/checkout/multi/delivery-address/mark_verified?pk="+d,function(e){$("#addressbook form").unbind(),$("#addressbook form").submit()})}),$(".useStandardizedAddress").click(function(){$("#popup_delivery_address_verification_form .status_msg").hide(),$("#popup_delivery_address_verification_form .loading").show(),y.line1=e.standardizedAddress1,y.postalCode=e.standardizedPostalCode,y.town=e.standardizedCity,y.region.isocode=e.standardizedState,y.country.isocode=e.standardizedISOCountry,$.post("/checkout/multi/delivery-address/update_address",{addressData:JSON.stringify(y)}).done(function(e){$("#addressbook form").unbind(),$("#addressbook form").submit()})}))},error:function(e,d,s){console.log(d),console.log(s),"timeout"==d&&console.log("timeout: by-pass address verification"),console.log("error by pass this step")}})}else $("#addressbook form").unbind(),$("#addressbook form").submit()}),(0<$("#addressForm.add").length||0<$("#addressForm.account-add-address").length)&&($("#addressForm.add").submit(function(e){e.preventDefault()}),$("#addressSubmit").on("click",function(e){if($("#inactive-veter").is(":visible"))e.preventDefault(),$("html, body").animate({scrollTop:$("#inactive-veter").offset().top},300);else{var d=$("#addressForm.add").data("bootstrapValidator");if(d.validate(),!d.isValid())return;$("#popup_delivery_address_verification_form").modal("show");var s=$("#addressForm.add #address\\.line1").val(),r=$("#addressForm.add #address\\.line2").val(),a=$("#addressForm.add #address\\.townCity").val(),t=$("#addressForm.add #address\\.country").val(),o=$("#addressForm.add #address\\.region").val().replace("US-",""),i=$("#addressForm.add #address\\.postcode").val();$("#popup_delivery_address_verification_form .status_msg").hide(),$("#popup_delivery_address_verification_form .loading").show();var n={line1:s,line2:r,town:a,postalCode:i,country:{isocode:t},shippingAddress:!1,billingAddress:!1,defaultAddress:!1,defaultAddress:!1,visibleInAddressBook:!1,editable:!1,region:{isocode:o,name:o}};$.ajax({type:"POST",url:"/dav",data:{reference_code:"1",addressData:JSON.stringify(n)},dataType:"json",timeout:5e3,success:function(e){"REJECT"==e.decision&&($("#popup_delivery_address_verification_form .loading").hide(),$("#popup_delivery_address_verification_form .reject").show(),$(".addressEnteredLine1").html(s),$(".addressEnteredCityStateZip").html(a+", "+o+" "+i),$(".addressEntredCountry").html(t),$(".continueWithThisAddress").click(function(){$("#addressForm.add").unbind("submit"),$("#addressForm.add").submit()})),"ACCEPT"==e.decision&&($("#popup_delivery_address_verification_form .loading").hide(),$("#popup_delivery_address_verification_form .pick_between2").show(),$(".standardizedAddress1").html(e.standardizedAddress1),void 0!==e.standardizedAddress2&&null!=e.standardizedAddress2&&""!=e.standardizedAddress2?($(".standardizedAddress2").html(e.standardizedAddress2),$(".standardizedAddress2").show()):$(".standardizedAddress2").hide(),$(".standardizedCity").html(e.standardizedCity+","),$(".standardizedState").html(e.standardizedState),$(".standardizedPostal").html(e.standardizedPostalCode),$(".standardizedISOCountry").html(e.standardizedISOCountry),$("#enteredAddress").html("line1:"+s+" | line2:"+s+" | townCity: "+a+" | postcode:"+i+" | country:"+t+" | region(state): "+o),$(".addressEnteredLine1").html(s),null!=r&&""!=r?($(".addressEnteredLine2").html(r),$(".addressEnteredLine2").show()):$(".addressEnteredLine2").hide(),$(".addressEnteredCityStateZip").html(a+", "+o+" "+i),$(".addressEntredCountry").html(t),$(".continueWithEnteredAddress").click(function(){$("#addressForm.add").unbind("submit"),$("#addressForm.add").submit()}),$(".useStandardizedAddress").click(function(){$("#addressForm.add #address\\.line1").val(e.standardizedAddress1),$("#addressForm.add #address\\.line2").val(""),$("#addressForm.add #address\\.townCity").val(e.standardizedCity),$("#addressForm.add #address\\.country").val(e.standardizedCountry),$("#addressForm.add #address\\.region").val("US-"+e.standardizedState),$("#addressForm.add #address\\.postcode").val(e.standardizedPostalCode),$("#addressForm.add").unbind("submit"),$("#addressForm.add").submit()})),console.log(e)},error:function(e,d,s){console.log(d),console.log(s),"timeout"==d&&console.log("timeout: by-pass address verification"),$("#addressForm.add").unbind("submit"),$("#addressForm.add").submit()}})}}),$("#addressForm.add , #addressForm.account-add-address").bootstrapValidator({excluded:":disabled",live:"disabled",fields:{firstName:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField}}},lastName:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField}}},line1:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField}}},line1:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField}}},townCity:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField}}},regionIso:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField}}},postcode:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField},regexp:{regexp:/(^\d{5}$)|(^\d{5}-\d{4}$)/,message:_addressErrorMSGs.invalidZipCode}}},countryIso:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField}}},phone:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField},regexp:{regexp:/^(\+0?1\s)?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{4}$/,message:_addressErrorMSGs.invalidPhoneNumber}}}}}).on("error.field.bv",function(e,d){d.bv.disableSubmitButtons(!1),$(".invalidAddressForm").show()}).on("success.field.bv",function(e,d){d.bv.disableSubmitButtons(!1),$(".invalidAddressForm").hide()}))})},bindToChangeAddressButton:function(){$(document).on("click",".summaryDeliveryAddress .editButton",ACC.address.handleChangeAddressButtonClick)},bindViewAddressBook:function(){$(document).on("click","#summaryOverlayViewAddressBook",function(){$("#summaryDeliveryAddressFormContainer").hide(),$("#summaryOverlayViewAddressBook").hide(),$("#summaryDeliveryAddressBook").show(),ACC.colorbox.resize()})},bindContinueButton:function(){$(document).on("click","#shippingAddressContiue",function(e){$("#inactive-veter").is(":visible")?($("html, body").animate({scrollTop:$("#inactive-veter").offset().top},300),e.preventDefault()):$("#addEditShippingAddressForm").submit()})},showRemoveAddressFromBookConfirmation:function(){$(document).on("click",".removeAddressFromBookButton",function(){var e=$(this).data("addressId"),d=$(this).data("popupTitle");ACC.colorbox.open(d,{inline:!0,height:!1,href:"#popup_confirm_address_removal_"+e,onComplete:function(){$(this).colorbox.resize()}})})},backToListAddresses:function(){$(".addressBackBtn").on("click",function(){var e=$(this).data("backToAddresses");window.location=e})},showAddNewAddressForm:function(){$(".add-new-address,.back ").on("click",function(e){var d="undefined"==typeof gtmGlobalEvent,s=$(e.currentTarget).hasClass("add-new-address");return!d&&s&&gtmGlobalEvent("checkout","shipping address","add new","gtm_event"),$("#addressbook").toggle(),$(".addNewAddressContainer").toggle(),$(".step-head.active").length&&$("html, body").animate({scrollTop:$(".step-head.active").offset().top},300),!1}),$(".back ").on("click",function(){$("form.add").trigger("reset"),$("#address\\.country").selectpicker("refresh"),$("#address\\.region").selectpicker("refresh"),$("form.add").bootstrapValidator("resetForm",!0),$(".invalidAddressForm").hide()})},handleSelectedAddress:function(){$("input[name='selectedAddressCode']").change(function(){$("input[name='selectedAddressCode']").each(function(){$(this).is(":checked")?$(this).parents(".addressEntry").addClass("selected"):$(this).parents(".addressEntry").removeClass("selected")})})},showEditAddressForm:function(){$(document).on("click",".edit-address",function(){var e=$(this).parent().find('[name="Unique"]').val(),d="/checkout/multi/delivery-address/edit",s="?";-1!==d.indexOf(s)&&(s="&");var r=d+s+"editAddressCode="+encodeURIComponent(e);$.ajax({url:r,type:"GET",success:function(e){var d=$(e).find("#editAddressModal");$("#editAddressModal").html($(d).html()),$(".selectpicker").selectpicker({}),$("select[id='address.region']").selectpicker("destroy").selectpicker({liveSearch:!0,noneSelectedText:"Please select",size:12}),$("#editAddressModal").modal("show"),0<$("#addressForm.edit").length&&$("#addressForm.edit").bootstrapValidator({excluded:":disabled",live:"disabled",fields:{firstName:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField}}},lastName:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField}}},line1:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField}}},townCity:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField}}},regionIso:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField}}},postcode:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField},regexp:{regexp:/(^\d{5}$)|(^\d{5}-\d{4}$)/,message:_addressErrorMSGs.invalidZipCode}}},phone:{validators:{notEmpty:{message:_addressErrorMSGs.requiredField},regexp:{regexp:/^(\+0?1\s)?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{4}$/,message:_addressErrorMSGs.invalidPhoneNumber}}}}}).on("error.field.bv",function(e,d){d.bv.disableSubmitButtons(!1)}).on("success.field.bv",function(e,d){d.bv.disableSubmitButtons(!1)}).on("success.form.bv",function(e){$(".page-multiStepCheckoutSummaryPage").length&&("undefined"==typeof gtmGlobalEvent||gtmGlobalEvent("checkout","shipping address","edit - update","gtm_event"))})},error:function(){}})}),$("#editAddressModal").on("hidden.bs.modal",function(){$("form.edit").trigger("reset"),$("form.edit").bootstrapValidator("resetForm",!0)}),$("#account-addressAddEditAddress").on("hidden.bs.modal",function(){$("#addressForm")[0].reset(),$("#addressForm").bootstrapValidator("resetForm")})}};
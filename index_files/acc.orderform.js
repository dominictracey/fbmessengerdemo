var ACC=ACC||{};0<$("#orderFormContainer").length&&(ACC.orderform={_autoload:["bindAll"],$selectedProductIdsContainer:$("#js-selected-product-ids"),$productIdsInput:$("#js-product-ids"),$enableProductIdsCheckBox:$("#js-enable-product-ids"),$productIdTagBoxTemplate:$("#product-id-tag-box-template"),$removeProductIdButton:$(".js-remove-product-id"),$advSearchButton:$(".adv_search_button"),$orderFormToggle:$(".js-show-order-form-grid-wrapper"),$searchCurrentLabel:$(".searchInput label"),$createOrderFormButton:$(".js-create-order-form-button"),$createOrderFormCheckbox:$(".js-checkbox-sku-id, .js-checkbox-base-product"),$baseProductCheckBox:$(".js-checkbox-base-product"),$skuIDCheckbox:$(".js-checkbox-sku-id"),$skuQuantityOrderInput:$(".sku-quantity"),$addToCartBtn:$("#js-add-to-cart-order-form-btn-top, #js-add-to-cart-order-form-btn-bottom"),$orderForm:$("#isCreateOrderForm"),$userQtyInputSelection:$("input[data-product-selection]"),$totalPrice:$(".js-total-price"),$totalItemsCount:$(".js-total-items-count > span"),$totalPriceValue:$(".js-total-price-value"),$advancedSearchForm:$("#advancedSearchForm"),bindAll:function(){ACC.orderform.bindToToggleProductIds(ACC.orderform.$enableProductIdsCheckBox),ACC.orderform.bindToRemoveProductId(ACC.orderform.$removeProductIdButton),ACC.orderform.bindToAdvSearchButton(ACC.orderform.$advSearchButton),ACC.orderform.bindOrderFormToggle(ACC.orderform.$orderFormToggle),ACC.orderform.bindToCreateOrderFormButton(ACC.orderform.$createOrderFormButton),ACC.orderform.bindToBaseProductCheckBox(ACC.orderform.$baseProductCheckBox),ACC.orderform.bindToSkuIDCheckBox(ACC.orderform.$skuIDCheckbox),ACC.orderform.bindAddToCartClick(ACC.orderform.$addToCartBtn),ACC.orderform.$enableProductIdsCheckBox.prop("checked")&&(ACC.orderform.replaceSearchLabel(!0),ACC.orderform.appendProductIdsForSearch()),$("#search-create-order-form").prop("checked")?(ACC.orderform.makeUserSelectionAfterPagination(),ACC.orderform.setStateOrderFormButton()):ACC.orderform.fillQuantityValueForPagination(ACC.orderform.$userQtyInputSelection),ACC.orderform.$advancedSearchForm.find("input[name='CSRFToken']").remove()},bindOrderFormToggle:function(r){r.click(function(r){var e=$(this);$(this).toggleClass("open");var o=$(this).parents(".js-item-list-item").next(".js-order-form-grid-wrapper");o.slideToggle("slow",function(){if(!e.data("calc")){var r=o.children("#cartOrderGridForm").addClass("visible");ACC.productorderform.coreTableScrollActions(r),e.data("calc",!0)}})})},bindToAdvSearchButton:function(r){r.click(function(r){ACC.orderform.$enableProductIdsCheckBox.prop("checked")&&(""!=ACC.orderform.$productIdsInput.val()&&ACC.orderform.appendProductIdsForSearch(),ACC.orderform.$productIdsInput.val(ACC.orderform.getProductsIdsFromSessionStorage())),ACC.orderform.stripOutInvalidChars(),ACC.orderform.$orderForm.val()?sessionStorage.clear():ACC.orderform.cleanupQtyInputFromSessionStorage()})},bindToCreateOrderFormButton:function(r){r.click(function(r){ACC.orderform.stripOutInvalidChars(),ACC.orderform.$productIdsInput.val(ACC.orderform.getProductsIdsFromSessionStorage()),ACC.orderform.$orderForm.val(!0),sessionStorage.removeItem("checkedProducts"),ACC.orderform.$selectedProductIdsContainer.empty(),ACC.orderform.$enableProductIdsCheckBox.attr("checked",!1),ACC.orderform.$advSearchButton.click()})},bindToBaseProductCheckBox:function(r){r.click(function(r){var e=this;$(ACC.orderform.$skuIDCheckbox).each(function(){$(this).attr("base-product-code")&&$(this).attr("base-product-code")==e.value&&($(this).prop("checked",e.checked),ACC.orderform.addProductIdsToSessionStorage(this))})})},bindToSkuIDCheckBox:function(r){r.click(function(r){ACC.orderform.addProductIdsToSessionStorage(this)})},addToSkuQtyInput:function(r){0!=ACC.orderform.$totalItemsCount.length&&0==ACC.orderform.$totalItemsCount.text()?ACC.orderform.$addToCartBtn.attr("disabled","disabled"):ACC.orderform.$addToCartBtn.removeAttr("disabled");for(var e=ACC.orderform.fetchOrPopulateSessionStorageObj("qtyInputs"),o=JSON.parse($(r).attr("data-product-selection")),t=ACC.orderform.filterMatchingQtyInputs(e,o),d=0;d<t.length;d++)e.splice(e.indexOf(t[d]),1);o.qty=r.value,e.push(o),sessionStorage.setItem("qtyInputs",JSON.stringify(e)),ACC.orderform.setTotalItemPrice($(r),r.value,$(r).siblings(".price").data("variant-price"))},setStateOrderFormButton:function(){ACC.orderform.$createOrderFormButton.attr("disabled","disabled"),0<ACC.orderform.getProductsIdsFromSessionStorage().length?ACC.orderform.$createOrderFormButton.removeAttr("disabled"):ACC.orderform.$createOrderFormButton.attr("disabled","disabled")},addProductIdsToSessionStorage:function(r){var e=JSON.parse(sessionStorage.getItem("checkedProducts"));null!=e&&null!=e||(sessionStorage.setItem("checkedProducts",JSON.stringify([])),e=new Array);var o=e.indexOf(r.value);r.checked?-1==o&&e.push(r.value):-1!=o&&e.splice(o,1),sessionStorage.setItem("checkedProducts",JSON.stringify(e)),console.log(sessionStorage.getItem("checkedProducts")),ACC.orderform.setStateOrderFormButton()},fetchOrPopulateSessionStorageObj:function(r){var e=JSON.parse(sessionStorage.getItem(r));return null!=e&&null!=e||(sessionStorage.setItem(r,JSON.stringify([])),e=new Array),e},makeUserSelectionAfterPagination:function(){var r=JSON.parse(sessionStorage.getItem("checkedProducts"));null!=r&&$(ACC.orderform.$skuIDCheckbox).each(function(){-1!=r.indexOf(this.value)&&$(this).prop("checked",!0)})},fillQuantityValueForPagination:function(r){var d,a,n=JSON.parse(sessionStorage.getItem("qtyInputs")),c={};null!=n&&0<n.length&&(r.each(function(r){var e=ACC.orderform.filterMatchingQtyInputs(n,JSON.parse($(this).attr("data-product-selection")));if(null!=e&&0<e.length){var o=e[0].qty,t=!1;$(this).attr("value",o),this.hasAttribute("data-variant-id")&&(a===$(this).parents("table").data("variant-loop")&&(t=!0),ACC.productorderform.calculateVariantTotal($(this),o),d===$(this).data("parent-id")&&a===$(this).parents("table").data("variant-loop")?ACC.productorderform.updateSelectedVariantGridTotal(this,0,!1,t):ACC.productorderform.updateSelectedVariantGridTotal(this,0,!0,t),d=$(this).data("parent-id"),c=$(this).parents("table"),a=c.data("variant-loop"))}}),ACC.orderform.$addToCartBtn.removeAttr("disabled")),ACC.orderform.resetPriceCounters()},getProductsIdsFromSessionStorage:function(){var r=ACC.orderform.fetchOrPopulateSessionStorageObj("checkedProducts");return null!=r&&""!=r?r.join(","):[]},removeProductIdFromSessionStorage:function(r){var e=JSON.parse(sessionStorage.getItem("checkedProducts")),o=e.indexOf(r);-1!=o&&e.splice(o,1),sessionStorage.setItem("checkedProducts",JSON.stringify(e))},bindToToggleProductIds:function(r){r.on("change",function(r){var e=$(this).prop("checked");ACC.orderform.replaceSearchLabel(e);var o=$.map(ACC.orderform.$selectedProductIdsContainer.find(".product-id-tag-box .product-id"),function(r){return $(r).text()}).join(", ");""!==o&&ACC.orderform.$productIdsInput.val(o),ACC.orderform.$selectedProductIdsContainer.empty()})},appendProductIdsForSearch:function(){ACC.orderform.stripOutInvalidChars();var r=ACC.orderform.$productIdsInput.val().split(",");r=$.map(r,function(r,e){return $.trim(r)}),r=$.unique(r);var t=ACC.orderform.fetchOrPopulateSessionStorageObj("checkedProducts");$.each(r,function(r,e){var o=ACC.orderform.$selectedProductIdsContainer.find("#product-id-"+e);""!==e&&0==o.length&&ACC.orderform.$productIdTagBoxTemplate.tmpl({productId:e,index:r}).appendTo(ACC.orderform.$selectedProductIdsContainer),-1==t.indexOf(e)&&t.push(e)}),sessionStorage.setItem("checkedProducts",JSON.stringify(t)),ACC.orderform.$productIdsInput.val(""),ACC.orderform.$productIdsInput.focus()},bindAddToCartClick:function(r){r.click(function(){$.ajax({url:ACC.productorderform.$addToCartOrderForm.attr("action"),type:"POST",dataType:"json",contentType:"application/json",data:ACC.orderform.getJSONDataForAddToCart(),async:!1,success:function(r){$(window).off("beforeunload",ACC.productorderform.beforeUnloadHandler),ACC.product.displayAddToCartPopup(r),ACC.orderform.cleanUserQtySelection(ACC.orderform.$userQtyInputSelection)},error:function(r,e,o){console.log("The following error occured: "+e,o)}})})},getJSONDataForAddToCart:function(){for(var r=ACC.orderform.fetchOrPopulateSessionStorageObj("qtyInputs"),e=[],o=0;o<r.length;o++)0<parseInt(r[o].qty)&&e.push({product:{code:r[o].product},quantity:r[o].qty});return JSON.stringify({cartEntries:e})},bindToRemoveProductId:function(r){ACC.orderform.$selectedProductIdsContainer.on("click",r,function(r){r.preventDefault();var e=$(r.target).parents(".js-remove-product-id");ACC.orderform.removeProductIdFromSessionStorage($(e).children(".product-id").text()),$(e).remove(),ACC.orderform.$selectedProductIdsContainer.empty(),ACC.orderform.$enableProductIdsCheckBox.attr("checked",!0),ACC.orderform.$productIdsInput.val(ACC.orderform.getProductsIdsFromSessionStorage()),ACC.orderform.$advSearchButton.click()})},cleanUserQtySelection:function(r){var e=ACC.orderform.fetchOrPopulateSessionStorageObj("qtyInputs");null!=e&&0<e.length&&r.each(function(){$(this).prop("value",0),ACC.orderform.$addToCartBtn.attr("disabled","disabled"),ACC.orderform.setTotalItemPrice($(this),0,0)}),ACC.productorderform.cleanValues(),ACC.productorderform.resetSelectedVariant(),ACC.orderform.$totalPrice.html(ACC.productorderform.formatTotalsCurrency("0.00")),ACC.orderform.$totalItemsCount.text("0"),ACC.orderform.$totalPriceValue.val(0),ACC.orderform.cleanupQtyInputFromSessionStorage()},replaceSearchLabel:function(r){var e=ACC.orderform.$searchCurrentLabel.html(),o=$("#searchByIdsLabel").val(),t=$("#searchByKeywordLabel").val();e=r?e.replace(t,o):e.replace(o,t),ACC.orderform.$searchCurrentLabel.html(e)},stripOutInvalidChars:function(){ACC.orderform.$productIdsInput.val(ACC.orderform.$productIdsInput.val().replace(/[^a-z0-9 ,.\-_]/gi,""))},cleanupQtyInputFromSessionStorage:function(){sessionStorage.removeItem("qtyInputs"),sessionStorage.removeItem("totalPrice"),sessionStorage.removeItem("totalPriceVal"),sessionStorage.removeItem("totalItems")},resetPriceCounters:function(){ACC.orderform.$totalItemsCount.text(sessionStorage.totalItems),ACC.orderform.$totalPrice.html(sessionStorage.totalPrice||ACC.productorderform.formatTotalsCurrency("0.00")),ACC.orderform.$totalPriceValue.val(sessionStorage.totalPriceVal||0),ACC.orderform.fillTotalItemPrice()},setTotalItemPrice:function(r,e,o){if(!r.data("variant-id")){var t=0<e?ACC.productorderform.formatTotalsCurrency(o*e):"";r.parent().next(".item-total").html(t)}},fillTotalItemPrice:function(){if(void 0!==sessionStorage.qtyInputs)for(var r=JSON.parse(sessionStorage.qtyInputs),e={},o=0;o<r.length;o++)if(0<r[o].qty){e=$("."+r[o].product);var t=ACC.productorderform.formatTotalsCurrency(e.siblings(".price").data("variant-price")*r[o].qty);e.parent().siblings(".item-total").html(t)}},filterMatchingQtyInputs:function(r,e){return $.grep(r,function(r){return e.product==r.product})}});
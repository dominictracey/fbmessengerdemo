ACC.productorderform={_autoload:["headerActions","coreTableActions","addToCartOrderGridForm"],$addToCartOrderForm:$("#AddToCartOrderForm"),$addToCartBtn:$("#addToCartBtn"),$omsErrorMessageContainer:$("#globalMessages"),$emptySkuQuantityInputs:$(".sku-quantity[value]"),$nonEmptySkuQuantityInputs:$(".sku-quantity[value]"),$totalGridValues:$("[data-grid-total-id]"),$futureTooltipTemplate:$("#future-stock-template"),$futureTooltipErrorTemplate:$("#future-tooltip-error-template"),$omsErrorMessageTemplate:$("#oms-error-message-template"),$variantSummaryTemplate:$("#variant-summary"),selectedVariantData:"selected-variant",selectedVariants:[],quantityTotal:0,scrollTopPos:0,headerActions:function(){ACC.productorderform.bindProductDetailToggle($(".product-details-toggle"))},coreTableActions:function(){ACC.productorderform.coreTableScrollActions(ACC.productorderform.$addToCartOrderForm),ACC.productorderform.bindUpdateFutureStockButton(".update_future_stock_button"),ACC.productorderform.bindHideFutureStockInfo(".hide_future_stock_info"),ACC.productorderform.bindVariantSelect($(".variant-select-btn"),"AddToCartOrderForm"),ACC.productorderform.cancelVariantModal(".closeVariantModal"),ACC.productorderform.checkLimitExceed(".sku-quantity");var r=".sku-quantity",t="#cboxContent .sku-quantity",h=0,v=0;ACC.productorderform.$addToCartOrderForm.on("click",r,function(r){$(this).select()}),ACC.productorderform.$addToCartOrderForm.on("focusin",r,function(r){h=jQuery.trim(this.value),$(this).parents("tr").next(".variant-summary").remove(),$(this).parents("table").data(ACC.productorderform.selectedVariantData)?ACC.productorderform.selectedVariants=$(this).parents("table").data(ACC.productorderform.selectedVariantData):ACC.productorderform.selectedVariants=[],""==h&&(h=0,this.value=0)}),$(r).on("blur keypress",function(r){var t=r.keyCode||r.which||r.charCode;if(13==t||null==t){var e=parseInt($(this).attr("id").match("[0-9]+")),o=0,a=$("input[id='productPrice["+e+"]']").val();this.value=ACC.productorderform.filterSkuEntry(this.value);var d=$(".js-total-items-count"),n=d.html(),i=$(".js-total-price-value").val(),s=$(this).parents(".orderForm_grid_group");if(isNaN(jQuery.trim(this.value))&&(this.value=0),""==(v=jQuery.trim(this.value))&&(v=0,this.value=0),ACC.orderform)void 0!==sessionStorage.totalItems&&void 0!==sessionStorage.totalPriceVal&&(n=sessionStorage.totalItems,i=sessionStorage.totalPriceVal),0==h?(d.html(parseInt(n)+parseInt(v)),o=parseFloat(i)+parseFloat(a)*parseInt(v)):(d.html(parseInt(n)+(parseInt(v)-parseInt(h))),o=parseFloat(i)+parseFloat(a)*(parseInt(v)-parseInt(h))),sessionStorage.totalPrice=ACC.productorderform.formatTotalsCurrency(o),sessionStorage.totalItems=d.html(),sessionStorage.totalPriceVal=o,ACC.orderform.addToSkuQtyInput(this);else if(s&&0<s.length){var l=s.find("#quantityValue"),u=s.find("#avgPriceValue"),c=s.find("#subtotalValue"),p=l.val(),f=c.val();0==h?(l.val(parseInt(p)+parseInt(v)),c.val(parseFloat(f)+parseFloat(a)*parseInt(v)),d.html(parseInt(n)+parseInt(v)),o=parseFloat(i)+parseFloat(a)*parseInt(v)):(l.val(parseInt(p)+(parseInt(v)-parseInt(h))),c.val(parseFloat(f)+parseFloat(a)*(parseInt(v)-parseInt(h))),d.html(parseInt(n)+(parseInt(v)-parseInt(h))),o=parseFloat(i)+parseFloat(a)*(parseInt(v)-parseInt(h))),ACC.productorderform.enableBeforeUnloadEvent(v,d.text()),0!=d.length&&0==d.text()?(ACC.productorderform.$addToCartBtn.attr("disabled","disabled"),$(window).off("beforeunload",ACC.productorderform.beforeUnloadHandler)):ACC.productorderform.$addToCartBtn.removeAttr("disabled"),0<parseInt(l.val())?u.val(parseFloat(c.val())/parseInt(l.val())):u.val(0)}if(s&&0<s.length){var C="",m=s.find("[data-grid-total-id=total_value_"+e+"]");0<v&&(C=ACC.productorderform.formatTotalsCurrency(parseFloat(a)*parseInt(v))),m.html(C),ACC.productorderform.updateSelectedVariantGridTotal(this,h,!1,!1)}$(".js-total-price").html(ACC.productorderform.formatTotalsCurrency(o)),$(".js-total-price-value").val(o)}}),$("body").on("focusin",t,function(){h=jQuery.trim(this.value);var r=$(this).data("variant-id"),t=$("#AddToCartOrderForm, #cartOrderGridForm").find("[data-variant-id='"+r+"']");t.trigger("focusin"),t.parents("table").find(".variant-summary").remove(),t.parents("table").data(ACC.productorderform.selectedVariantData)?ACC.productorderform.selectedVariants=t.parents("table").data(ACC.productorderform.selectedVariantData):ACC.productorderform.selectedVariants=[],""==h&&(h=0,this.value=0)}),$("body").on("blur",t,function(){var r=$(this).siblings(".price"),t=$(this).siblings(".data-grid-total"),e=$(this).data("variant-id"),o=$("#AddToCartOrderForm, #cartOrderGridForm").find("[data-variant-id='"+e+"']");this.value=ACC.productorderform.filterSkuEntry(this.value),(isNaN(jQuery.trim(this.value))||this.value<0||""==this.value)&&(this.value=0),o.val(this.value),o.trigger("blur"),ACC.productorderform.updateVariantTotal(r,this.value,t),0<this.value&&this.value!=h?(o.parents("table").addClass("selected"),o.trigger("change")):0===ACC.productorderform.selectedVariants.length&&o.parents("table").removeClass("selected")})},updateSelectedVariantGridTotal:function(e,r,t,o){var a=$(e).siblings(".price"),d=$(e).siblings(".variant-prop"),n=$(e).next(".td_stock").data("sku-id"),i=$(e).siblings(".data-grid-total");if(t&&(ACC.productorderform.selectedVariants=[]),e.value!=r){var s=!0;ACC.productorderform.selectedVariants.forEach(function(r,t){r.id===n&&(s=!1,"0"===e.value||0===e.value?ACC.productorderform.selectedVariants.splice(t,1):(ACC.productorderform.selectedVariants[t].quantity=e.value,ACC.productorderform.selectedVariants[t].total=ACC.productorderform.updateVariantTotal(a,e.value,i)))}),s&&0<e.value&&ACC.productorderform.selectedVariants.push({id:n,size:d.data("variant-prop"),quantity:e.value,total:ACC.productorderform.updateVariantTotal(a,e.value,i)})}o&&$(e).parents("table").find(".variant-summary").remove(),ACC.productorderform.showSelectedVariant($(e).parents("table")),0<e.value&&e.value!=r?$(e).parents("table").addClass("selected"):0===ACC.productorderform.selectedVariants.length&&$(e).parents("table").removeClass("selected").find(".variant-summary").remove()},updateVariantTotal:function(r,t,e){var o=parseFloat(r.data("variant-price"))*parseInt(t);return e.html(ACC.productorderform.formatTotalsCurrency(o)),ACC.productorderform.formatTotalsCurrency(o)},bindUpdateFutureStockButton:function(r){$("body").on("click",r,function(r){r.preventDefault();var t=$(this).parents(".orderForm_grid_group").find(".product-grid-container"),e=jQuery.map(t.find("input[type='hidden'].sku"),function(r){return r.value}),o=$(this).data("skusId"),a=$(this).data("skusFutureStockUrl"),d={skus:e,productCode:o},n=$(this).parent().find(".hide_future_stock_info"),i=$(this);$.ajax({url:a,type:"POST",data:d,traditional:!0,dataType:"json",success:function(r){ACC.productorderform.updateFuture(t,e,r,o,i,n)},error:function(r,t,e){alert("Failed to get delivery modes. Error details ["+r+", "+t+", "+e+"]")}})})},bindHideFutureStockInfo:function(r){$("body").on("click",r,function(r){r.preventDefault();var t=$(this).parent().parent().find(".product-grid-container");$(this).parent().find(".update_future_stock_button").show(),$(this).hide(),t.find("[data-sku-id]").children(".future_stock, .out-of-stock").remove()})},updateFuture:function(n,r,i,t,e,o){var a;ACC.productorderform.$omsErrorMessageContainer.find("div").remove(),null!==i&&void 0!==i["basket.page.viewFuture.unavailable"]?$.tmpl(ACC.productorderform.$omsErrorMessageTemplate,{errorMessage:i["basket.page.viewFuture.unavailable"]}).appendTo(ACC.productorderform.$omsErrorMessageContainer):(a=i,Object.keys(a).length<=0||(e.hide(),o.css("display","block"),$.each(r,function(r,t){var e=i[t],o=n.find("[data-sku-id='"+t+"']"),a=-1!=o[0].attributes.class.nodeValue.indexOf("in-stock"),d=null!=e&&null!==e[0]&&void 0!==e[0];o.children(".future_stock, .out-of-stock").remove(),d?(a||o.addClass("future-stock"),$.tmpl(ACC.productorderform.$futureTooltipTemplate,{formattedDate:e[0].formattedDate,availabilities:e}).appendTo(o)):a||(o[0].attributes.class.nodeValue="td_stock out-of-stock")})))},toJSON:function(r,t){for(var e=r.find("input.sku").map(function(r,t){return t.value}),o=r.find("input.sku-quantity").map(function(r,t){return parseInt(t.value)}),a=[],d=0;d<e.length;d++)t&&0===o[d]||a.push({product:{code:e[d]},quantity:o[d]});return JSON.stringify({cartEntries:a})},formatTotalsCurrency:function(r){return Currency.formatMoney(Number(r).toFixed(2),Currency.money_format[ACC.common.currentCurrency])},cleanValues:function(){if(0!==$(".orderForm_grid_group").length){var r=ACC.productorderform.formatTotalsCurrency("0.00");$(".js-total-price").html(r),$("#quantity, .js-total-items-count").html(0),$("#quantityValue, #avgPriceValue, #subtotalValue, .js-total-price-value").val(0),ACC.productorderform.$emptySkuQuantityInputs.val(0),ACC.productorderform.$totalGridValues.html("")}},calculateGrid:function(){ACC.productorderform.$nonEmptySkuQuantityInputs.trigger("focusout")},bindProductDetailToggle:function(r){r.on("click",function(r){r.preventDefault(),$(this).parents(".product-details").toggleClass("open")})},showSelectedVariant:function(r){$.tmpl(ACC.productorderform.$variantSummaryTemplate,{variants:ACC.productorderform.selectedVariants}).appendTo(r),$(".variant-summary .variant-property").html($(".variant-detail").data("variant-property")),r.data(ACC.productorderform.selectedVariantData,ACC.productorderform.selectedVariants),r.removeClass("currentVariant")},bindVariantSelect:function(d,n){d.on("click",function(r){r.preventDefault();var t=$(this).parents("table");t.data(ACC.productorderform.selectedVariantData)?ACC.productorderform.selectedVariants=t.data(ACC.productorderform.selectedVariantData):ACC.productorderform.selectedVariants=[];var e=d.html(),o=$("#"+n).clone().empty().attr("id",n+"Variant");t.addClass("currentVariant");var a=$(this).parents(".orderForm_grid_group").clone();t.removeClass("currentVariant"),$(a).find(".currentVariant").siblings().remove(),o.html(a),o.find(".hidden-xs").removeClass("hidden-xs"),o.find(".hide").removeClass("hide"),scrollTopPos=$("body").scrollTop(),$("body").scrollTop(0),ACC.colorbox.open(e,{html:o,width:"100%",reposition:!1,className:"variantSelectMobile",onCleanup:function(){0<ACC.productorderform.$addToCartOrderForm.find(".selected").length?ACC.productorderform.$addToCartBtn.removeAttr("disabled"):ACC.productorderform.$addToCartBtn.attr("disabled","disabled"),$("body").scrollTop(scrollTopPos)}})})},cancelVariantModal:function(r){$("body").on("click",r,function(r){r.preventDefault(),ACC.colorbox.close()})},checkLimitExceed:function(r){$("body").on("keyup blur",r,function(r){var t=Number($(this).val()),e=Number($(this).attr("data-instock"));e<t&&$(this).val(e)})},resetSelectedVariant:function(){ACC.productorderform.selectedVariants=[],$(".product-grid-container table").removeData(ACC.productorderform.selectedVariantData).removeClass("selected").removeClass("currentVariant")},addToCartOrderGridForm:function(){$("#AddToCartOrderForm").keypress(function(r){"13"==r.which&&r.preventDefault()}),ACC.productorderform.$addToCartBtn.click(function(){ACC.productorderform.$addToCartBtn.attr("disabled","disabled"),$.ajax({url:ACC.productorderform.$addToCartOrderForm.attr("action"),type:"POST",dataType:"json",contentType:"application/json",data:ACC.productorderform.toJSON(ACC.productorderform.$addToCartOrderForm,!0),async:!1,success:function(r){$(window).off("beforeunload",ACC.productorderform.beforeUnloadHandler),ACC.product.displayAddToCartPopup(r),ACC.productorderform.cleanValues(),ACC.productorderform.resetSelectedVariant()},error:function(r,t,e){console.log("The following error occured: "+t,e)}})})},beforeUnloadHandler:function(){return ACC.productorderform.$addToCartOrderForm.attr("data-grid-confirm-message")},enableBeforeUnloadEvent:function(r,t){ACC.orderform||0<r&&0<t&&$(window).off("beforeunload",ACC.productorderform.beforeUnloadHandler).on("beforeunload",ACC.productorderform.beforeUnloadHandler)},filterSkuEntry:function(r){return/\D/g.test(r)?r.replace(/\D/g,""):r},coreTableScrollActions:function(e){if(e.hasClass("visible")){ACC.productorderform.orderGridScroll(e);var r,t,o=e.parent().find(".order-form-scroll.right"),a=e.parent().find(".order-form-scroll.left"),d=e.parent().find(".order-form-scroll.up"),n=e.parent().find(".order-form-scroll.down"),i=e.find(".widthReference").outerWidth(),s=e.find(".product-grid-container table").eq(0).height()/2,l=0,u=0;e.find(".product-grid-container table").each(function(){$(this).outerWidth()>l&&(l=$(this).outerWidth())}),e.find(".orderForm_grid_group").each(function(){u+=$(this).height()}),r=l-e.outerWidth(),t=u-e.height()+14,e.scroll(function(){0<$(this).scrollLeft()?a.show():a.hide(),$(this).scrollLeft()>=r?o.hide():o.show(),0<$(this).scrollTop()?d.show():d.hide(),$(this).scrollTop()>=t?n.hide():n.show(),e.find(".update-future-stock").css("margin-right",-$(this).scrollLeft())}),e.parent().find(".order-form-scroll").click(function(){var r=e.scrollLeft(),t=e.scrollTop();$(this).hasClass("right")?e.scrollLeft(r+i):$(this).hasClass("left")?e.scrollLeft(r-i):$(this).hasClass("up")?e.scrollTop(t-s):e.scrollTop(t+s)})}},orderGridScroll:function(r){var t=!1,e=0,o=$(r).find(".orderForm_grid_group").innerWidth(),a=$(r).innerHeight()-18;$(r).find(".product-grid-container table").each(function(){$(this).width()>o&&(t=!0),e+=$(this).height()}),t&&$(r).parent().find(".order-form-scroll.right").show(),a<e&&$(r).parent().find(".order-form-scroll.down").show()},calculateVariantTotal:function(r,t){var e=r.parents(".orderForm_grid_group"),o=parseInt(r.attr("id").match("[0-9]+")),a=$("input[id='productPrice["+o+"]']").val(),d=e.find("[data-grid-total-id=total_value_"+o+"]");0<t&&d.html(ACC.productorderform.formatTotalsCurrency(parseFloat(a)*parseInt(t)))}};
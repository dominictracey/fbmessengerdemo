var ACC=ACC||{};0<$("#quickOrder").length&&(ACC.quickorder={_autoload:["bindClearQuickOrderRow","bindAddSkuInputRow","bindResetFormBtn","bindAddToCartClick"],$quickOrderContainer:$(".js-quick-order-container"),$quickOrderMinRows:Number($(".js-quick-order-container").data("quickOrderMinRows")),$quickOrderMaxRows:Number($(".js-quick-order-container").data("quickOrderMaxRows")),$productExistsInFormMsg:$(".js-quick-order-container").data("productExistsInFormMsg"),$quickOrderLeavePageMsg:$("#quickOrder").data("gridConfirmMessage"),$hiddenSkuInput:"input.js-hidden-sku-field",$addToCartBtn:$("#js-add-to-cart-quick-order-btn-top, #js-add-to-cart-quick-order-btn-bottom"),$resetFormBtn:$("#js-reset-quick-order-form-btn-top, #js-reset-quick-order-form-btn-bottom"),$productInfoContainer:".js-product-info",$skuInputField:".js-sku-input-field",$qtyInputField:".js-quick-order-qty",$jsLiContainer:"li.js-li-container",$removeQuickOrderRowBtn:".js-remove-quick-order-row",$skuValidationContainer:".js-sku-validation-container",$qtyValidationContainer:".js-qty-validation-container",$productItemTotal:".js-quick-order-item-total",$classHasError:"has-error",bindResetFormBtn:function(){ACC.quickorder.$resetFormBtn.on("click",ACC.quickorder.clearForm)},bindAddToCartClick:function(){ACC.quickorder.$addToCartBtn.on("click",ACC.quickorder.addToCart)},bindAddSkuInputRow:function(){$(ACC.quickorder.$skuInputField).on("focusin",ACC.quickorder.addInputRow).on("focusout keydown",ACC.quickorder.handleFocusOutOnSkuInput)},bindClearQuickOrderRow:function(){$(ACC.quickorder.$removeQuickOrderRowBtn).on("mousedown",ACC.quickorder.clearQuickOrderRow)},addToCart:function(){$.ajax({url:ACC.quickorder.$quickOrderContainer.data("quickOrderAddToCartUrl"),type:"POST",dataType:"json",contentType:"application/json",data:ACC.quickorder.getJSONDataForAddToCart(),async:!1,success:function(r){ACC.quickorder.handleAddToCartSuccess(r)},error:function(r,e,t){console.log("The following error occurred: "+e,t)}})},handleAddToCartSuccess:function(r){0<$(r.quickOrderErrorData).size()&&ACC.quickorder.disableBeforeUnloadEvent();var o={};r.quickOrderErrorData.forEach(function(r){o[r.sku]=r.errorMsg}),$(ACC.quickorder.$qtyInputField).each(function(){var r=ACC.quickorder.getCurrentParentLi(this),e=ACC.quickorder.findElement(r,ACC.quickorder.$skuInputField).val(),t=o[e];t?ACC.quickorder.findElement(r,ACC.quickorder.$skuValidationContainer).text(t):ACC.quickorder.findElement(r,ACC.quickorder.$removeQuickOrderRowBtn).trigger("mousedown")}),ACC.quickorder.handleBeforeUnloadEvent(),ACC.product.displayAddToCartPopup(r)},getJSONDataForAddToCart:function(){var t=[];return $(ACC.quickorder.$qtyInputField).each(function(){var r=Number($(this).val());if(0<r){var e=jQuery.trim(ACC.quickorder.findElementInCurrentParentLi(this,ACC.quickorder.$skuInputField).val());t.push({product:{code:e},quantity:r})}}),JSON.stringify({cartEntries:t})},handleFocusOutOnSkuInput:function(r){13==(r.charCode?r.charCode:r.keyCode?r.keyCode:0)&&$(r.target).focusout(),"focusout"==r.type&&(ACC.quickorder.handleGetProduct(r),ACC.quickorder.handleBeforeUnloadEvent())},handleFocusOutOnQtyInput:function(r){13==(r.charCode?r.charCode:r.keyCode?r.keyCode:0)&&(r.preventDefault(),ACC.quickorder.getCurrentParentLi(r.target).next().find(ACC.quickorder.$skuInputField).focus(),$(r.target).focusout());"focusout"==r.type&&(ACC.quickorder.validateAndUpdateItemTotal(r),ACC.quickorder.enableDisableAddToCartBtn())},clearForm:function(){window.location.reload()},validateAndUpdateItemTotal:function(r){var e=ACC.quickorder.getCurrentParentLi(r.target),t=jQuery.trim(ACC.productorderform.filterSkuEntry($(r.target).val()));if(isNaN(t)||""==t)t=0,$(r.target).removeClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(e,ACC.quickorder.$qtyValidationContainer).text(""),$(r.target).val(0);else{t=Number(t),$(r.target).val(t);var o=jQuery.trim(ACC.quickorder.findElement(e,ACC.quickorder.$qtyInputField).data("maxProductQty")),n=jQuery.trim(ACC.quickorder.findElement(e,ACC.quickorder.$qtyInputField).data("stockLevelStatus"));if(o=$.isEmptyObject(o)&&"inStock"==n?"FORCE_IN_STOCK":Number(o),!isNaN(o)&&o<t){$(r.target).addClass(ACC.quickorder.$classHasError);var i=ACC.quickorder.findElement(e,ACC.quickorder.$qtyValidationContainer);i.text(i.data("maxProductQtyMsg")),t=o,$(r.target).val(o)}else $(r.target).removeClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(e,ACC.quickorder.$qtyValidationContainer).text("")}if(0<t){var d=parseFloat(ACC.quickorder.findElement(e,".js-product-price").data("productPrice"));ACC.quickorder.findElement(e,ACC.quickorder.$productItemTotal).html(ACC.productorderform.formatTotalsCurrency(d*t))}else ACC.quickorder.findElement(e,ACC.quickorder.$productItemTotal).text("")},clearQuickOrderRow:function(){var r=ACC.quickorder.$quickOrderMinRows,e=ACC.quickorder.getCurrentParentLi(this);$(".js-ul-container li.js-li-container").length>r?(e.remove(),ACC.quickorder.bindClearQuickOrderRow()):(ACC.quickorder.findElement(e,ACC.quickorder.$productInfoContainer).remove(),ACC.quickorder.findElement(e,ACC.quickorder.$skuValidationContainer).text(""),ACC.quickorder.findElement(e,ACC.quickorder.$skuInputField).val(""),ACC.quickorder.findElement(e,ACC.quickorder.$hiddenSkuInput).val("")),ACC.quickorder.enableDisableAddToCartBtn(),ACC.quickorder.handleBeforeUnloadEvent()},addInputRow:function(r){if($(".js-quick-order-container li.js-li-container:last-child").find(ACC.quickorder.$skuInputField).is($(r.target))&&$(ACC.quickorder.$jsLiContainer).length<ACC.quickorder.$quickOrderMaxRows){var e=$(".js-quick-order-container li.js-li-container:first").clone();ACC.quickorder.findElement(e,ACC.quickorder.$productInfoContainer).remove(),ACC.quickorder.findElement(e,ACC.quickorder.$skuValidationContainer).text(""),ACC.quickorder.findElement(e,ACC.quickorder.$hiddenSkuInput).val("");var t=ACC.quickorder.findElement(e,ACC.quickorder.$skuInputField);t.val(""),t.focusin(ACC.quickorder.addInputRow).focusout(ACC.quickorder.handleFocusOutOnSkuInput).keydown(ACC.quickorder.handleFocusOutOnSkuInput),ACC.quickorder.findElement(e,ACC.quickorder.$removeQuickOrderRowBtn).click(ACC.quickorder.clearQuickOrderRow),$(".js-ul-container").append(e)}},handleGetProduct:function(r){var e=ACC.quickorder.getCurrentParentLi(r.target),t=$.trim(r.target.value);$(r.target).val(t),ACC.quickorder.isCurrentSkuSameAsPrevious(e,t)||(0<t.length?(ACC.quickorder.findElement(e,ACC.quickorder.$productInfoContainer).remove(),ACC.quickorder.isDuplicateSku(r.target,t)?ACC.quickorder.findElement(e,ACC.quickorder.$skuValidationContainer).text(ACC.quickorder.$productExistsInFormMsg):ACC.quickorder.getAndDisplayProductInfo(r,e,t),ACC.quickorder.findElement(e,ACC.quickorder.$hiddenSkuInput).val(t)):($(r.target).removeClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(e,ACC.quickorder.$skuValidationContainer).text(""),ACC.quickorder.findElement(e,ACC.quickorder.$productInfoContainer).remove()))},isCurrentSkuSameAsPrevious:function(r,e){return ACC.quickorder.findElement(r,ACC.quickorder.$hiddenSkuInput).val()==e},isDuplicateSku:function(r,e){var t=!1;return $(ACC.quickorder.$skuInputField).each(function(){if($(this).val()==e&&!$(this).is($(r)))return!(t=!0)}),t},getAndDisplayProductInfo:function(t,o,r){var e=ACC.config.encodedContextPath+"/quickOrder/productInfo?code="+r;$.getJSON(e,function(r){if(null!=r.errorMsg&&0<r.errorMsg.length)$(t.target).addClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(o,ACC.quickorder.$skuValidationContainer).text(r.errorMsg);else{$(t.target).removeClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(o,ACC.quickorder.$skuValidationContainer).text(""),$("#quickOrderRowTemplate").tmpl(r.productData).insertAfter(ACC.quickorder.findElement(o,".js-sku-container"));var e=ACC.quickorder.findElement(o,ACC.quickorder.$qtyInputField);e.focusout(ACC.quickorder.handleFocusOutOnQtyInput).keydown(ACC.quickorder.handleFocusOutOnQtyInput),"outOfStock"==r.productData.stock.stockLevelStatus.code?(e.val(0),e.prop("disabled",!0)):e.focus().select(),ACC.quickorder.enableDisableAddToCartBtn()}})},handleBeforeUnloadEvent:function(){ACC.quickorder.isAnySkuPresent()?(ACC.quickorder.disableBeforeUnloadEvent(),ACC.quickorder.enableBeforeUnloadEvent()):ACC.quickorder.disableBeforeUnloadEvent()},disableBeforeUnloadEvent:function(){$(window).off("beforeunload",ACC.quickorder.beforeUnloadHandler)},enableBeforeUnloadEvent:function(){$(window).on("beforeunload",ACC.quickorder.beforeUnloadHandler)},beforeUnloadHandler:function(){return ACC.quickorder.$quickOrderLeavePageMsg},enableDisableAddToCartBtn:function(){ACC.quickorder.shouldAddToCartBeEnabled()?ACC.quickorder.$addToCartBtn.removeAttr("disabled"):ACC.quickorder.$addToCartBtn.attr("disabled","disabled")},shouldAddToCartBeEnabled:function(){var e=0,t=!1;return $(ACC.quickorder.$qtyInputField).each(function(){var r=this.value.trim();if(r&&(e+=parseInt(r,10)),1<=e)return!(t=!0)}),t},isAnySkuPresent:function(){var r=!1;return $(ACC.quickorder.$skuInputField).each(function(){if(jQuery.trim(this.value))return!(r=!0)}),r},getCurrentParentLi:function(r){return $(r).closest(ACC.quickorder.$jsLiContainer)},findElement:function(r,e){return $(r).find(e)},findElementInCurrentParentLi:function(r,e){return $(r).closest(ACC.quickorder.$jsLiContainer).find(e)}});
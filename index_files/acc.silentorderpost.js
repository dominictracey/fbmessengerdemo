ACC.silentorderpost={spinner:$("<img src='"+ACC.config.commonResourcePath+"/images/spinner.gif' />"),bindUseDeliveryAddress:function(){if($("#useDeliveryAddress").on("change",function(){if($("#useDeliveryAddress").is(":checked")){var e={countryIsoCode:$("#useDeliveryAddressData").data("countryisocode"),useDeliveryAddress:!0};ACC.silentorderpost.displayCreditCardAddressForm(e,ACC.silentorderpost.useDeliveryAddressSelected)}else ACC.silentorderpost.clearAddressForm()}),$("#useDeliveryAddress").is(":checked")){var e={countryIsoCode:$("#useDeliveryAddressData").data("countryisocode"),useDeliveryAddress:!0};ACC.silentorderpost.displayCreditCardAddressForm(e,ACC.silentorderpost.useDeliveryAddressSelected)}},bindSubmitSilentOrderPostForm:function(){$(".submit_silentOrderPostForm").click(function(){ACC.common.blockFormAndShowProcessingMessage($(this)),$(".billingAddressForm").filter(":hidden").remove(),$("#silentOrderPostForm").submit()})},bindCycleFocusEvent:function(){$("#lastInTheForm").blur(function(){$('#silentOrderPostForm [tabindex$="10"]').focus()})},isEmpty:function(e){return null==e||""===e},clearAddressForm:function(){$('input[id^="address\\."]').val(""),$('select[id^="address\\."]').val("")},useDeliveryAddressSelected:function(){$("#useDeliveryAddress").is(":checked")?$("#address\\.country").val($("#useDeliveryAddressData").data("countryisocode")):ACC.silentorderpost.clearAddressForm()},bindCreditCardAddressForm:function(){$("#billingCountrySelector :input").on("change",function(){var e={countryIsoCode:$(this).val(),useDeliveryAddress:!1};ACC.silentorderpost.displayCreditCardAddressForm(e)})},displayCreditCardAddressForm:function(e,l){$.ajax({url:ACC.config.encodedContextPath+"/checkout/multi/sop/billingaddressform",async:!0,data:e,dataType:"html",beforeSend:function(){}}).done(function(e){$("#billingAddressForm").append(e),$("#sopPaymentDetailsForm").css("display","none");var r=$("#sopPaymentDetailsForm #address\\.firstName").val(),s=$("#sopPaymentDetailsForm #address\\.surname").val(),d=$("#sopPaymentDetailsForm #address\\.line1").val(),t=$("#sopPaymentDetailsForm #address\\.line2").val(),a=$("#sopPaymentDetailsForm #address\\.townCity").val(),i=$("#sopPaymentDetailsForm #address\\.state").val(),o=$("#sopPaymentDetailsForm #address\\.postcode").val(),n=$("#sopPaymentDetailsForm #address\\.billing.phone").val();$("#sopPaymentDetailsForm").remove(),$("#useDeliveryAddress").is(":checked")&&($("#billingAddressForm #address\\.firstName").val(r),$("#billingAddressForm #address\\.surname").val(s),$("#billingAddressForm #address\\.line1").val(d),$("#billingAddressForm #address\\.line2").val(t),$("#billingAddressForm #address\\.townCity").val(a),$("#billingAddressForm #address\\.state").val(i),$("#billingAddressForm #address\\.postcode").val(o),$("#billingAddressForm #address\\.billing.phone").val(n)),"function"==typeof l&&l.call(),$("#address\\.region").selectpicker("refresh"),ACC.silentorderpost.bindValidationPaymentForm("add")})},bindValidationPaymentForm:function(e){if($("#silentEditOrderPostForm").length||$("#silentOrderPostForm").length){var r="",s="",d="",t="",o="",n="",a="";"edit"==e?(r="#silentEditOrderPostForm",s="#edit_card_cardType",d="#edit_card_name",t="#edit_card_accountNumber",o="#EditExpiryMonth",n="#EditExpiryYear",a="#edit_card_cvNumber"):"add"==e&&(r="#silentOrderPostForm",s="#card_cardType",d="#card_name",t="#card_accountNumber",o="#ExpiryMonth",n="#ExpiryYear",a="#card_cvNumber"),$(r).bootstrapValidator({live:"disabled",fields:{billTo_firstName:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField}}},billTo_lastName:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField}}},billTo_street1:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField}}},billTo_country:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField}}},billTo_city:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField}}},billTo_state:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField}}},billTo_postalCode:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField},regexp:{regexp:/(^\d{5}$)|(^\d{5}-\d{4}$)/,message:payment_FormErrorMSGs.invalidZipCode}}},billTo_phoneNumber:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField},regexp:{regexp:/^(\+0?1\s)?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{4}$/,message:payment_FormErrorMSGs.invalidPhoneNumber}}},cardname:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField},callback:{message:payment_FormErrorMSGs.invalidCardInfo,callback:function(){var e=$(d).val();return""==e||!!/^(?:['a-zA-Z-\s]+)$/.test(e)}}}},card_expirationMonth:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField},callback:{message:payment_FormErrorMSGs.invalidCardInfo,callback:function(){var e=new Date,r=e.getMonth()+1,s=e.getFullYear(),d=$(n).val(),t=parseInt(d),a=$(o).val(),i=parseInt(a);return null==a||(s<t||t==s&&r<i)}}}},card_expirationYear:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField},callback:{message:payment_FormErrorMSGs.invalidCardInfo,callback:function(){var e=(new Date).getFullYear(),r=$(n).val(),s=parseInt(r);return null==r||!!(/^(?:[0-9]+)$/.test(s)&&e<=s)}}}},card_cardType:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField}}},card_accountNumber:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField},callback:{message:payment_FormErrorMSGs.invalidCardInfo,callback:function(){var e=$(s).val(),r=$(t).val();return""===r||(!("001"!==e||16!==r.length||!/^(?:4[0-9]{12}(?:[0-9]{3})?)$/.test(r))||(!("003"!==e||15!==r.length||!/^(?:3[47][0-9]{13})$/.test(r))||(!("024"!==e||16!==r.length||!/^(?:(5018|5020|5038|6304|6759|6761|6763)[0-9]{8,15})$/.test(r))||(!("002"!==e||16!==r.length||!/^(?:[25]{1}[1-7][0-9]{14})$/.test(r))||(!("005"!==e||14!==r.length||!/^(?:3(?:0[0-5]|[68][0-9])[0-9]{11})$/.test(r))||!("004"!==e||16!==r.length||!/6(?:011|5[0-9]{2})[0-9]{12}/.test(r)))))))}}}},card_cvNumber:{validators:{notEmpty:{message:payment_FormErrorMSGs.requierdField},callback:{message:payment_FormErrorMSGs.invalidCardInfo,callback:function(){var e=/^(?:[0-9]{3,4})$/,r=$(a).val();if(""==r)return!0;if("003"==$(s).val()){if(e.test(r)&&4==r.length)return!0}else if(e.test(r)&&3==r.length)return!0;return!1}}}}}}).on("error.field.bv",function(e,r){$(".invalid-payment").length&&$(".invalid-payment").show()}).on("success.form.bv",function(e){$(".invalid-payment").length&&$(".invalid-payment").hide()})}}},$(document).ready(function(){with(ACC.silentorderpost)bindUseDeliveryAddress(),bindSubmitSilentOrderPostForm(),bindCreditCardAddressForm();$("#silentOrderPostForm .back ").on("click",function(){$(".invalid-payment").hide()}),$("#useDeliveryAddress").click()});
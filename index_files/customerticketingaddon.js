ACC.customerticketingaddon={_autoload:["onStatusChange","bindMessageArea","toggleAllMessages","postNewMessage","onFileChosen","bindTicketAddActions","bindTicketUpdateActions"],disableMessage:function(e){var t=$('input[id="currentTicketStatus"]').val(),s=$(e).val();"COMPLETED"===t&&"COMPLETED"===s||"CLOSED"===t&&"CLOSED"===s?($('textarea[id="message"]').attr("disabled","disabled"),$('button[id="updateTicket"]').attr("disabled","disabled")):$('textarea[id="message"]').removeAttr("disabled")},onStatusChange:function(){$(document).on("change",".js-add-message-status",function(){ACC.customerticketingaddon.disableMessage(this)})},onFileChosen:function(){$(document).on("change","#supportTicketForm input[name=files]",function(){ACC.customerticketingaddon.clearAlerts();var e=document.getElementById("attachmentFiles");if(!ACC.customerticketingaddon.isSelectedFilesValid(e)){var t="<span style='color:red'>"+$("#file-too-large-message").text()+"</span>";$("#supportTicketForm").find(".js-file-upload__file-name").html(t)}})},bindMessageArea:function(){$(document).on("keyup",".js-add-message",function(){0<$(this).val().length?($('button[id="updateTicket"]').removeAttr("disabled"),$("#NotEmpty-supportTicketForm-message").hide()):$('button[id="updateTicket"]').attr("disabled","disabled")})},toggleAllMessages:function(){$("#ct-toggle-all-messages").on("click touchstart",function(){$(".cts-msg-history-item:not(.ct-msg-visible)").show(),$(this).hide()})},postNewMessage:function(){var t=$("#ct-overlay-title").html();$(".ct-add-new-msg-btn").on("click touchstart",function(e){e.preventDefault(),$.colorbox({href:"#ct-add-new-msg",maxWidth:"100%",width:525,opacity:.7,title:t,inline:!0,close:'<span class="glyphicon glyphicon-remove"></span>',onOpen:function(){$("#ct-add-new-msg").fadeIn()},onComplete:function(){ACC.customerticketingaddon.disableMessage($(".js-add-message-status")),$('button[id="updateTicket"]').attr("disabled","disabled"),ACC.csvimport.changeFileUploadAppearance()},onCleanup:function(){$("#ct-add-new-msg").hide()}})})},isSelectedFilesValid:function(e){if(window.File&&window.Blob){for(var t=$(".js-file-upload__input").data("max-upload-size"),s=0,a=0;a<e.files.length;++a)s+=e.files[a].size;if($.isNumeric(t)&&s>parseFloat(t))return!1}return!0},displayCustomerTicketingAlert:function(e){var t;switch(e.type){case"error":t="#global-alert-danger-template";break;case"warning":t="#global-alert-warning-template";break;default:t="#global-alert-info-template"}void 0!==e.message&&$("#customer-ticketing-alerts").append($(t).tmpl({message:e.message})),void 0!==e.messageId&&$("#customer-ticketing-alerts").append($(t).tmpl({message:$("#"+e.messageId).text()}))},displayGlobalAlert:function(e){var t;switch(e.type){case"error":t="#global-alert-danger-template";break;case"warning":t="#global-alert-warning-template";break;default:t="#global-alert-info-template"}void 0!==e.message&&$("#global-alerts").append($(t).tmpl({message:e.message})),void 0!==e.messageId&&$("#global-alerts").append($(t).tmpl({message:$("#"+e.messageId).text()}))},bindTicketAddActions:function(){$(document).on("click","#addTicket",function(e){e.preventDefault(),ACC.customerticketingaddon.formPostAction("support-tickets?ticketAdded=true")})},bindTicketUpdateActions:function(){$(document).on("click","#updateTicket",function(e){e.preventDefault(),ACC.customerticketingaddon.formPostAction("?ticketUpdated=true")})},formPostAction:function(e){ACC.customerticketingaddon.clearAlerts();var t=document.getElementById("supportTicketForm"),s=new window.FormData(t),a=document.getElementById("attachmentFiles");ACC.customerticketingaddon.isSelectedFilesValid(a)?$.ajax({url:t.action,type:"POST",data:s,contentType:!1,processData:!1,success:function(){window.location.replace(e)},error:function(e){ACC.customerticketingaddon.processErrorResponse(e)}}):ACC.customerticketingaddon.displayCustomerTicketingAlert({type:"error",messageId:"attachment-file-max-size-exceeded-error-message"})},processErrorResponse:function(e){ACC.customerticketingaddon.clearAlerts(),400===e.status&&e.responseJSON?$.each(e.responseJSON,function(){$.each(this,function(e,t){var s="#"+e;$(s).show(),$(s).text(t),"NotEmpty-supportTicketForm-subject"===e||"Size-supportTicketForm-subject"===e||"NotEmpty-supportTicketForm-message"===e||"Size-supportTicketForm-message"===e?ACC.customerticketingaddon.addHasErrorClass():ACC.customerticketingaddon.displayGlobalAlert({type:"error",message:t})})}):ACC.customerticketingaddon.displayCustomerTicketingAlert({type:"error",messageId:"supporttickets-tryLater"})},addHasErrorClass:function(){$("#createTicket-message").parent().addClass("has-error")},clearAlerts:function(){$("#customer-ticketing-alerts").empty(),$("#global-alerts").empty(),$("#NotEmpty-supportTicketForm-subject").hide(),$("#Size-supportTicketForm-message").hide(),$("#Size-supportTicketForm-subject").hide(),$("#createTicket-subject").parent().removeClass("has-error"),$("#NotEmpty-supportTicketForm-message").hide(),$("#createTicket-message").parent().removeClass("has-error")}};
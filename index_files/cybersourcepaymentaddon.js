ACC.secureacceptance={_autoload:["attachHandlerForPlaceOrderBtn","initSOPIframeDialog"],checkOrderStatusInterval:function(e,a){setInterval(function(){ACC.secureacceptance.checkOrderStatus(e)},a)},checkOrderStatus:function(e){$.ajax({url:ACC.config.contextPath+"/checkout/payment/sa/haspaymentsaved",cache:!1,dataType:"json",data:{cartGuid:e},success:function(e){1==e?window.location=ACC.config.contextPath+"/checkout/multi/summary/view":2==e&&(window.location=ACC.config.contextPath+"/checkout/multi/payment-method/add/payment/error")}})},initSOPIframeDialog:function(){var e=$("#sopIframeCbox");e&&e.dialog({title:"Payment Details",autoOpen:!1,width:500,dialogClass:"no-close",modal:!1})},startSOPIframeTimeout:function(e){var a=null;e.load(function(){a&&clearTimeout(a),a=setTimeout(function(){$("#sopIframeCbox").dialog("open")},3e3)})},attachHandlerForPlaceOrderBtn:function(){var r=function(e){e.removeAttr("hidden"),e.closest(".form-group").addClass("has-error")},d=function(e){e.attr("hidden","hidden"),e.closest(".form-group").removeClass("has-error")},c=function(){return $("#card_cardType option:selected").val()},l=function(){var e=u();return e.substr(e.length-4)},s=function(){return u().substr(0,6)},u=function(){return $("#card_accountNumber").val()},_=function(){return $("#ExpiryMonth option:selected").text()+"-"+$("#ExpiryYear option:selected").text()},m=function(){return $("#ExpiryYear option:selected").val()},h=function(){return $("#ExpiryMonth option:selected").val()},e=function(){0<$("#nochargeNote").val().length?$.ajax({url:ACC.config.contextPath+"/checkout/multi/payment-method/nocharge",type:"POST",data:{note:$("#nochargeNote").val()},cache:!1,success:function(e){window.location="1"==e?ACC.config.contextPath+"/checkout/multi/summary/view":ACC.config.contextPath+"/checkout/multi/payment-method/add/payment/error"}}):$("#nochargeNote").change(function(){0===$("#nochargeNote").val().length?$("#nochargeNote").parent().addClass("has-error").find(".help-block").removeClass("hidden"):$("#nochargeNote").parent().removeClass("has-error").find(".help-block").addClass("hidden")}).change()},a=function(){0<$("#paidInClinicInvoiceNumber").val().length&&0<$("#paidInClinicNote").val().length?$.ajax({url:ACC.config.contextPath+"/checkout/multi/payment-method/paidInClinic",type:"POST",data:{invoiceNumber:$("#paidInClinicInvoiceNumber").val(),note:$("#paidInClinicNote").val()},cache:!1,success:function(e){window.location="1"==e?ACC.config.contextPath+"/checkout/multi/summary/view":ACC.config.contextPath+"/checkout/multi/payment-method/add/payment/error"}}):($("#paidInClinicInvoiceNumber").change(function(){0===$("#paidInClinicInvoiceNumber").val().length?$("#paidInClinicInvoiceNumber").parent().addClass("has-error").find(".help-block").removeClass("hidden"):$("#paidInClinicInvoiceNumber").parent().removeClass("has-error").find(".help-block").addClass("hidden")}).change(),$("#paidInClinicNote").change(function(){0===$("#paidInClinicNote").val().length?$("#paidInClinicNote").parent().addClass("has-error").find(".help-block").removeClass("hidden"):$("#paidInClinicNote").parent().removeClass("has-error").find(".help-block").addClass("hidden")}).change())},t=$(".cs_btn-next-payment"),n=$("#csr-user").length;t&&t.click(function(){n&&$("#nochargeCheckbox").is(":checked")?e():n&&$("#paidInClinicCheckbox").is(":checked")?a():$("#hopRequestForm").length?($("#Terms1").is(":checked")?($(".tc-unchecked-alert").attr("hidden","hidden"),1):($(".tc-unchecked-alert").removeAttr("hidden"),0))&&$("#hopRequestForm").submit():($("#silentOrderPostForm").data("bootstrapValidator").validate(),$("#silentOrderPostForm").data("bootstrapValidator").isValid()?function(){if(o=[{value:c(),error:$("#card_cardType_errors")},{value:u(),error:$("#card_accountNumber_errors")},{value:m(),error:$("#card_expirationYear_errors")},{value:h(),error:$("#card_expirationMonth_errors")}],i=!0,o.forEach(function(e){Boolean(e.value)?d(e.error):(r(e.error),i=!1)}),i){var e,a,t=$("#sopRequestIframe"),n=t.contents().find("#sopRequestForm");a=$("#useDeliveryAddress").is(":checked")?{bill_to_forename:(e=$("#useDeliveryAddressData")).attr("data-firstname"),bill_to_surname:e.attr("data-lastname"),bill_to_address_country:e.attr("data-countryisocode"),bill_to_address_city:e.attr("data-town"),bill_to_address_state:e.attr("data-regionisocode"),bill_to_address_line1:e.attr("data-line1"),bill_to_address_line2:e.attr("data-line2"),bill_to_address_postal_code:e.attr("data-postalcode"),savePaymentInfo:$("#savePaymentInfo").is(":checked"),firstSixDigits:s(),lastFourDigits:l(),asmNotes:$("#asmNotes").val()}:{bill_to_forename:(e=$("#billingAddressForm")).find("#address\\.firstName").val(),bill_to_surname:e.find("#address\\.surname").val(),bill_to_address_country:"US",bill_to_address_city:e.find("#address\\.townCity").val(),bill_to_address_state:e.find("#address\\.region").val(),bill_to_address_line1:e.find("#address\\.line1").val(),bill_to_address_line2:e.find("#address\\.line2").val(),bill_to_address_postal_code:e.find("#address\\.postcode").val(),savePaymentInfo:$("#savePaymentInfo").is(":checked"),firstSixDigits:s(),lastFourDigits:l(),asmNotes:$("#asmNotes").val()},$.ajax({url:ACC.config.contextPath+"/checkout/payment/sa/sopAjax",type:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},dataType:"json",data:JSON.stringify(a),cache:!1,success:function(e){n.find("#access_key").val(e.access_key),n.find("#profile_id").val(e.profile_id),n.find("#transaction_uuid").val(e.transaction_uuid),n.find("#signed_date_time").val(e.signed_date_time),n.find("#locale").val(e.locale),n.find("#reference_number").val(e.reference_number),n.find("#amount").val(e.amount),n.find("#currency").val(e.currency),n.find("#payment_method").val(e.payment_method),n.find("#bill_to_forename").val(e.bill_to_forename),n.find("#bill_to_surname").val(e.bill_to_surname),n.find("#bill_to_email").val(e.bill_to_email),n.find("#bill_to_address_line1").val(e.bill_to_address_line1),n.find("#bill_to_address_line2").val(e.bill_to_address_line2),n.find("#bill_to_address_city").val(e.bill_to_address_city),n.find("#bill_to_address_country").val(e.bill_to_address_country),n.find("#bill_to_address_postal_code").val(e.bill_to_address_postal_code),n.find("#bill_to_address_state").val(e.bill_to_address_state),n.find("#override_custom_receipt_page").val(e.override_custom_receipt_page),n.find("#override_backoffice_post_url").val(e.override_backoffice_post_url),n.find("#partner_solution_id").val(e.partner_solution_id),n.find("#developer_id").val(e.developer_id),n.find("#merchant_defined_data99").val(e.merchant_defined_data99),n.find("#merchant_defined_data100").val(e.merchant_defined_data100),n.find("#signed_field_names").val(e.signed_field_names),n.find("#unsigned_field_names").val(e.unsigned_field_names),n.find("#signature").val(e.signature),n.find("#card_type").val(c()),n.find("#card_number").val(u()),n.find("#card_expiry_date").val(_()),n.find("#card_cvn").val($("#card_cvNumber").val()),n.find("#req_card_type").val(c()),n.find("#req_card_number").val(u()),n.find("#req_card_expiry_date").val(_()),n.submit(),ACC.secureacceptance.startSOPIframeTimeout(t);var a=t.contents().find("#cart_guid").val();ACC.secureacceptance.checkOrderStatusInterval(a,2e3)},error:function(e,a,t){console.log("Status: "+a),console.log("Error: "+t)}})}var o,i}():$("html, body").animate({scrollTop:$('#silentOrderPostForm .help-block[data-bv-result="INVALID"]').first().offset().top-100},300))});var o=$(".cs_btn-save-card");o&&o.click(function(){n&&$("#nochargeCheckbox").is(":checked")?e():n&&$("#paidInClinicCheckbox").is(":checked")?a():$.ajax({url:ACC.config.contextPath+"/checkout/multi/payment-method/saveCard",type:"POST",data:{paymentId:$("input[name='payment_method']:checked").val(),asmNotes:$("#asmNotes").val()},cache:!1,success:function(e){window.location="1"==e?ACC.config.contextPath+"/checkout/multi/summary/view":ACC.config.contextPath+"/checkout/multi/payment-method/add/payment/error"},error:function(e,a,t){console.log("Status: "+a),console.log("Error: "+t),window.location=ACC.config.contextPath+"/checkout/multi/payment-method/add/payment/error"}})});var i=$(".cs_btn-place-order");i&&(i.attr("disabled",!1),i.click(function(e){i.attr("disabled","disabled"),e.preventDefault(),e.stopPropagation();var a=e.target,t=$(a);0<t.parents(".place-order-summery").length?$(".place-order-summery #placeOrderForm1").submit():t.parents(".visible-xs")&&$(".col-sm-pull-4 #placeOrderForm1").submit()})),$("#nochargeCheckbox"),$("input[type=radio][name=csr_payment_method]").on("change",function(){var e=$(".csr-payment-content"),a=$("#noChargeNoteDiv"),t=$("#paidInClinicDiv"),n=$("#silentOrderPostForm"),o=$("#savedPayments"),i=$("#btnNextPaymentStep");switch(e.addClass("hidden"),i.removeClass("hide"),$(this).val()){case"nocharge":a.removeClass("hidden");break;case"paidInClinic":t.removeClass("hidden");break;case"addNewPayment":n.removeClass("hidden").removeClass("hide");break;case"selectPayment":o.removeClass("hidden").removeClass("hide"),i.addClass("hide")}})}};